"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
function chooseImage(count) {
    if (count === void 0) { count = 1; }
    return new Promise(function (resolve, reject) {
        wx.chooseImage({
            count: count,
            success: function (res) {
                var files = [];
                for (var _i = 0, _a = res.tempFiles; _i < _a.length; _i++) {
                    var file = _a[_i];
                    if (file.size > 1024000) {
                        wx.showToast({
                            title: '文件大小不能超过1M',
                            icon: 'none'
                        });
                        return reject('over size');
                    }
                    files.push(file.path);
                }
                resolve((count === 1 ? files[0] : files));
            },
            fail: function (res) { return reject(res.errMsg); }
        });
    });
}
exports.chooseImage = chooseImage;
Component({
    externalClasses: ['custom-class'],
    properties: {
        value: {
            type: null,
            value: ''
        },
        text: {
            type: String,
            value: '上传图片'
        },
        height: {
            type: String,
            value: 'auto'
        },
        count: {
            type: Number,
            value: 1
        }
    },
    attached: function () {
        var _a = this.data, count = _a.count, value = _a.value;
        var isString = typeof value === 'string';
        var isArray = Array.isArray(value);
        var flag = false;
        if (count < 1) {
            count = 1;
            value = isString ? value : '';
            flag = true;
        }
        else if (count > 1 && !isArray) {
            value = [];
            flag = true;
        }
        else if (!isString) {
            value = isArray ? value[0] || '' : '';
            flag = true;
        }
        if (flag) {
            this.setData({ count: count });
            this.triggerEvent('input', { value: value }, {});
        }
    },
    methods: {
        choose: function () {
            var _this = this;
            chooseImage(this.data.count)
                .then(function (value) { return _this.triggerEvent('input', { value: value }, {}); })
                .catch(console.error);
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBsb2FkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidXBsb2FkLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBSUEsU0FBZ0IsV0FBVyxDQUF1QyxLQUFpQjtJQUFqQixzQkFBQSxFQUFBLFNBQWlCO0lBQy9FLE9BQU8sSUFBSSxPQUFPLENBQUMsVUFBQyxPQUFPLEVBQUUsTUFBTTtRQUMvQixFQUFFLENBQUMsV0FBVyxDQUFDO1lBQ1gsS0FBSyxPQUFBO1lBQ0wsT0FBTyxFQUFFLFVBQUMsR0FBRztnQkFDVCxJQUFNLEtBQUssR0FBRyxFQUFFLENBQUM7Z0JBQ2pCLEtBQWtCLFVBQWEsRUFBYixLQUFBLEdBQUcsQ0FBQyxTQUFTLEVBQWIsY0FBYSxFQUFiLElBQWEsRUFBRTtvQkFBN0IsSUFBTSxJQUFJLFNBQUE7b0JBQ1YsSUFBSSxJQUFJLENBQUMsSUFBSSxHQUFHLE9BQU8sRUFBRTt3QkFDckIsRUFBRSxDQUFDLFNBQVMsQ0FBQzs0QkFDVCxLQUFLLEVBQUUsWUFBWTs0QkFDbkIsSUFBSSxFQUFFLE1BQU07eUJBQ2YsQ0FBQyxDQUFDO3dCQUVILE9BQU8sTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDO3FCQUM5QjtvQkFFRCxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztpQkFDekI7Z0JBRUQsT0FBTyxDQUFJLENBQUMsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ2pELENBQUM7WUFDRCxJQUFJLEVBQUUsVUFBQSxHQUFHLElBQUksT0FBQSxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFsQixDQUFrQjtTQUNsQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUM7QUF4QkQsa0NBd0JDO0FBRUQsU0FBUyxDQUFDO0lBQ04sZUFBZSxFQUFFLENBQUMsY0FBYyxDQUFDO0lBQ2pDLFVBQVUsRUFBRTtRQUNSLEtBQUssRUFBRTtZQUNILElBQUksRUFBRSxJQUFJO1lBQ1YsS0FBSyxFQUFFLEVBQUU7U0FDWjtRQUNELElBQUksRUFBRTtZQUNGLElBQUksRUFBRSxNQUFNO1lBQ1osS0FBSyxFQUFFLE1BQU07U0FDaEI7UUFDRCxNQUFNLEVBQUU7WUFDSixJQUFJLEVBQUUsTUFBTTtZQUNaLEtBQUssRUFBRSxNQUFNO1NBQ2hCO1FBQ0QsS0FBSyxFQUFFO1lBQ0gsSUFBSSxFQUFFLE1BQU07WUFDWixLQUFLLEVBQUUsQ0FBQztTQUNYO0tBQ0o7SUFDRCxRQUFRO1FBQ0EsSUFBQSxjQUEwQixFQUF6QixnQkFBSyxFQUFFLGdCQUFrQixDQUFDO1FBQy9CLElBQU0sUUFBUSxHQUFHLE9BQU8sS0FBSyxLQUFLLFFBQVEsQ0FBQztRQUMzQyxJQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRXJDLElBQUksSUFBSSxHQUFHLEtBQUssQ0FBQztRQUNqQixJQUFHLEtBQUssR0FBRyxDQUFDLEVBQUU7WUFDVixLQUFLLEdBQUcsQ0FBQyxDQUFDO1lBQ1YsS0FBSyxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDOUIsSUFBSSxHQUFHLElBQUksQ0FBQztTQUNmO2FBQU0sSUFBRyxLQUFLLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQzdCLEtBQUssR0FBRyxFQUFFLENBQUM7WUFDWCxJQUFJLEdBQUcsSUFBSSxDQUFDO1NBQ2Y7YUFBTSxJQUFHLENBQUMsUUFBUSxFQUFFO1lBQ2pCLEtBQUssR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUN0QyxJQUFJLEdBQUcsSUFBSSxDQUFDO1NBQ2Y7UUFFRCxJQUFHLElBQUksRUFBRTtZQUNMLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBQyxLQUFLLE9BQUEsRUFBQyxDQUFDLENBQUM7WUFDdEIsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsRUFBRSxLQUFLLE9BQUEsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1NBQzdDO0lBQ0wsQ0FBQztJQUNELE9BQU8sRUFBRTtRQUNMLE1BQU07WUFBTixpQkFJQztZQUhHLFdBQVcsQ0FBb0IsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7aUJBQzFDLElBQUksQ0FBQyxVQUFBLEtBQUssSUFBSSxPQUFBLEtBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLEVBQUUsS0FBSyxPQUFBLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBekMsQ0FBeUMsQ0FBQztpQkFDeEQsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM5QixDQUFDO0tBQ0o7Q0FDSixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICog5LiK5Lyg5Zu+54mHXHJcbiAqL1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNob29zZUltYWdlPFQgZXh0ZW5kcyBzdHJpbmcgfCBzdHJpbmdbXSA9IHN0cmluZz4oY291bnQ6IG51bWJlciA9IDEpOiBQcm9taXNlPFQ+IHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgd3guY2hvb3NlSW1hZ2Uoe1xyXG4gICAgICAgICAgICBjb3VudCxcclxuICAgICAgICAgICAgc3VjY2VzczogKHJlcykgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZmlsZXMgPSBbXTtcclxuICAgICAgICAgICAgICAgIGZvcihjb25zdCBmaWxlIG9mIHJlcy50ZW1wRmlsZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZS5zaXplID4gMTAyNDAwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3eC5zaG93VG9hc3Qoe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICfmlofku7blpKflsI/kuI3og73otoXov4cxTScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpY29uOiAnbm9uZSdcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0KCdvdmVyIHNpemUnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGZpbGVzLnB1c2goZmlsZS5wYXRoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKDxUPihjb3VudCA9PT0gMSA/IGZpbGVzWzBdIDogZmlsZXMpKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZmFpbDogcmVzID0+IHJlamVjdChyZXMuZXJyTXNnKVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbkNvbXBvbmVudCh7XHJcbiAgICBleHRlcm5hbENsYXNzZXM6IFsnY3VzdG9tLWNsYXNzJ10sXHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgdmFsdWU6IHtcclxuICAgICAgICAgICAgdHlwZTogbnVsbCxcclxuICAgICAgICAgICAgdmFsdWU6ICcnXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0ZXh0OiB7XHJcbiAgICAgICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICAgICAgdmFsdWU6ICfkuIrkvKDlm77niYcnXHJcbiAgICAgICAgfSxcclxuICAgICAgICBoZWlnaHQ6IHtcclxuICAgICAgICAgICAgdHlwZTogU3RyaW5nLFxyXG4gICAgICAgICAgICB2YWx1ZTogJ2F1dG8nXHJcbiAgICAgICAgfSxcclxuICAgICAgICBjb3VudDoge1xyXG4gICAgICAgICAgICB0eXBlOiBOdW1iZXIsXHJcbiAgICAgICAgICAgIHZhbHVlOiAxXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIGF0dGFjaGVkKCkge1xyXG4gICAgICAgIGxldCB7Y291bnQsIHZhbHVlfSA9IHRoaXMuZGF0YTtcclxuICAgICAgICBjb25zdCBpc1N0cmluZyA9IHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZyc7XHJcbiAgICAgICAgY29uc3QgaXNBcnJheSA9IEFycmF5LmlzQXJyYXkodmFsdWUpO1xyXG5cclxuICAgICAgICBsZXQgZmxhZyA9IGZhbHNlO1xyXG4gICAgICAgIGlmKGNvdW50IDwgMSkge1xyXG4gICAgICAgICAgICBjb3VudCA9IDE7XHJcbiAgICAgICAgICAgIHZhbHVlID0gaXNTdHJpbmcgPyB2YWx1ZSA6ICcnO1xyXG4gICAgICAgICAgICBmbGFnID0gdHJ1ZTtcclxuICAgICAgICB9IGVsc2UgaWYoY291bnQgPiAxICYmICFpc0FycmF5KSB7XHJcbiAgICAgICAgICAgIHZhbHVlID0gW107XHJcbiAgICAgICAgICAgIGZsYWcgPSB0cnVlO1xyXG4gICAgICAgIH0gZWxzZSBpZighaXNTdHJpbmcpIHtcclxuICAgICAgICAgICAgdmFsdWUgPSBpc0FycmF5ID8gdmFsdWVbMF0gfHwgJycgOiAnJztcclxuICAgICAgICAgICAgZmxhZyA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZihmbGFnKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7Y291bnR9KTtcclxuICAgICAgICAgICAgdGhpcy50cmlnZ2VyRXZlbnQoJ2lucHV0JywgeyB2YWx1ZSB9LCB7fSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIG1ldGhvZHM6IHtcclxuICAgICAgICBjaG9vc2UoKSB7XHJcbiAgICAgICAgICAgIGNob29zZUltYWdlPHN0cmluZyB8IHN0cmluZ1tdPih0aGlzLmRhdGEuY291bnQpXHJcbiAgICAgICAgICAgICAgICAudGhlbih2YWx1ZSA9PiB0aGlzLnRyaWdnZXJFdmVudCgnaW5wdXQnLCB7IHZhbHVlIH0sIHt9KSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pO1xyXG4iXX0=