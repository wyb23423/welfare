"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var store_1 = require("../../constant/store");
var index_1 = require("../../constant/index");
var http_1 = require("../../utils/http");
Component({
    properties: {
        isindex: {
            type: Boolean,
            value: false
        },
        hasinfo: {
            type: Boolean,
            value: true
        }
    },
    data: {
        time: 0,
        count: 0
    },
    ready: function () {
        var auth = wx.getStorageSync(store_1.USER_AUTHENTICATION);
        this.data.hasCommodity = !(auth === index_1.Authentication.commodity || auth === index_1.Authentication.auditing);
        this.setData({ username: wx.getStorageSync(store_1.USER_NAME) });
    },
    methods: {
        clickAvator: function () {
            var _a = this.data, count = _a.count, time = _a.time, hasCommodity = _a.hasCommodity;
            if (!hasCommodity) {
                return;
            }
            var now = Date.now();
            if (now - time >= 500) {
                count = 0;
            }
            this.data.time = now;
            this.data.count = ++count;
            count >= 5 && this.authentication();
        },
        authentication: function () {
            var _this = this;
            wx.showModal({
                content: '申请成为社区管理员?',
                success: function (_a) {
                    var confirm = _a.confirm;
                    if (confirm) {
                        http_1.request({ url: '/api/user/communityAuthorization' })
                            .then(function () { return wx.showToast({ title: '申请成功' }); })
                            .then(function () { return _this.setData({ hasCommodity: false }); })
                            .catch(console.log);
                    }
                },
                complete: function () { return _this.data.count = _this.data.time = 0; }
            });
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGVyc29uX2hlYWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJwZXJzb25faGVhZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUdBLDhDQUFzRTtBQUN0RSw4Q0FBc0Q7QUFDdEQseUNBQTJDO0FBTTNDLFNBQVMsQ0FBYTtJQUNsQixVQUFVLEVBQUU7UUFDUixPQUFPLEVBQUU7WUFDTCxJQUFJLEVBQUUsT0FBTztZQUNiLEtBQUssRUFBRSxLQUFLO1NBQ2Y7UUFDRCxPQUFPLEVBQUU7WUFDTCxJQUFJLEVBQUUsT0FBTztZQUNiLEtBQUssRUFBRSxJQUFJO1NBQ2Q7S0FDSjtJQUNELElBQUksRUFBRTtRQUNGLElBQUksRUFBRSxDQUFDO1FBQ1AsS0FBSyxFQUFFLENBQUM7S0FDWDtJQUNELEtBQUs7UUFDRCxJQUFNLElBQUksR0FBRyxFQUFFLENBQUMsY0FBYyxDQUFDLDJCQUFtQixDQUFDLENBQUM7UUFDcEQsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEdBQUcsQ0FBQyxDQUFDLElBQUksS0FBSyxzQkFBYyxDQUFDLFNBQVMsSUFBSSxJQUFJLEtBQUssc0JBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNsRyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQyxjQUFjLENBQUMsaUJBQVMsQ0FBQyxFQUFDLENBQUMsQ0FBQztJQUMzRCxDQUFDO0lBQ0QsT0FBTyxFQUFFO1FBQ0wsV0FBVztZQUVILElBQUEsY0FBdUMsRUFBdEMsZ0JBQUssRUFBRSxjQUFJLEVBQUUsOEJBQXlCLENBQUM7WUFDNUMsSUFBRyxDQUFDLFlBQVksRUFBRTtnQkFDZCxPQUFPO2FBQ1Y7WUFDRCxJQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDdkIsSUFBRyxHQUFHLEdBQUcsSUFBSSxJQUFJLEdBQUcsRUFBRTtnQkFDbEIsS0FBSyxHQUFHLENBQUMsQ0FBQzthQUNiO1lBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDO1lBQ3JCLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsS0FBSyxDQUFDO1lBQzFCLEtBQUssSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3hDLENBQUM7UUFDRCxjQUFjO1lBQWQsaUJBYUM7WUFaRyxFQUFFLENBQUMsU0FBUyxDQUFDO2dCQUNULE9BQU8sRUFBRSxZQUFZO2dCQUNyQixPQUFPLEVBQUUsVUFBQyxFQUFTO3dCQUFSLG9CQUFPO29CQUNkLElBQUcsT0FBTyxFQUFFO3dCQUNSLGNBQU8sQ0FBQyxFQUFDLEdBQUcsRUFBRSxrQ0FBa0MsRUFBQyxDQUFDOzZCQUM3QyxJQUFJLENBQUMsY0FBTSxPQUFBLEVBQUUsQ0FBQyxTQUFTLENBQUMsRUFBQyxLQUFLLEVBQUUsTUFBTSxFQUFDLENBQUMsRUFBN0IsQ0FBNkIsQ0FBQzs2QkFDekMsSUFBSSxDQUFDLGNBQU0sT0FBQSxLQUFJLENBQUMsT0FBTyxDQUFDLEVBQUMsWUFBWSxFQUFFLEtBQUssRUFBQyxDQUFDLEVBQW5DLENBQW1DLENBQUM7NkJBQy9DLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7cUJBQzNCO2dCQUNMLENBQUM7Z0JBQ0QsUUFBUSxFQUFFLGNBQU0sT0FBQSxLQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFJLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLEVBQXBDLENBQW9DO2FBQ3ZELENBQUMsQ0FBQztRQUNQLENBQUM7S0FDSjtDQUNKLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiDkuKrkurrkv6Hmga/pobXpobbpg6jlpLTlg4/lj4rlkI3np7BcclxuICovXHJcbmltcG9ydCB7IFVTRVJfTkFNRSwgVVNFUl9BVVRIRU5USUNBVElPTiB9IGZyb20gJy4uLy4uL2NvbnN0YW50L3N0b3JlJztcclxuaW1wb3J0IHsgQXV0aGVudGljYXRpb24gfSBmcm9tICcuLi8uLi9jb25zdGFudC9pbmRleCc7XHJcbmltcG9ydCB7IHJlcXVlc3QgfSBmcm9tICcuLi8uLi91dGlscy9odHRwJztcclxuXHJcbmludGVyZmFjZSBQZXJzb25IZWFkIGV4dGVuZHMgV3hDb21wb25lbnQge1xyXG4gICAgYXV0aGVudGljYXRpb24oKTogdm9pZDtcclxufVxyXG5cclxuQ29tcG9uZW50PFBlcnNvbkhlYWQ+KHtcclxuICAgIHByb3BlcnRpZXM6IHtcclxuICAgICAgICBpc2luZGV4OiB7XHJcbiAgICAgICAgICAgIHR5cGU6IEJvb2xlYW4sXHJcbiAgICAgICAgICAgIHZhbHVlOiBmYWxzZVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaGFzaW5mbzoge1xyXG4gICAgICAgICAgICB0eXBlOiBCb29sZWFuLFxyXG4gICAgICAgICAgICB2YWx1ZTogdHJ1ZVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBkYXRhOiB7XHJcbiAgICAgICAgdGltZTogMCwgLy8g5LiK5qyh54K55Ye75aS05YOP5pe26Ze0XHJcbiAgICAgICAgY291bnQ6IDAgLy8g6L+e57ut54K55Ye75aS05YOP5qyh5pWwXHJcbiAgICB9LFxyXG4gICAgcmVhZHkoKSB7XHJcbiAgICAgICAgY29uc3QgYXV0aCA9IHd4LmdldFN0b3JhZ2VTeW5jKFVTRVJfQVVUSEVOVElDQVRJT04pO1xyXG4gICAgICAgIHRoaXMuZGF0YS5oYXNDb21tb2RpdHkgPSAhKGF1dGggPT09IEF1dGhlbnRpY2F0aW9uLmNvbW1vZGl0eSB8fCBhdXRoID09PSBBdXRoZW50aWNhdGlvbi5hdWRpdGluZyk7XHJcbiAgICAgICAgdGhpcy5zZXREYXRhKHt1c2VybmFtZTogd3guZ2V0U3RvcmFnZVN5bmMoVVNFUl9OQU1FKX0pO1xyXG4gICAgfSxcclxuICAgIG1ldGhvZHM6IHtcclxuICAgICAgICBjbGlja0F2YXRvcigpIHtcclxuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnByZWZlci1jb25zdFxyXG4gICAgICAgICAgICBsZXQge2NvdW50LCB0aW1lLCBoYXNDb21tb2RpdHl9ID0gdGhpcy5kYXRhO1xyXG4gICAgICAgICAgICBpZighaGFzQ29tbW9kaXR5KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcclxuICAgICAgICAgICAgaWYobm93IC0gdGltZSA+PSA1MDApIHtcclxuICAgICAgICAgICAgICAgIGNvdW50ID0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmRhdGEudGltZSA9IG5vdztcclxuICAgICAgICAgICAgdGhpcy5kYXRhLmNvdW50ID0gKytjb3VudDtcclxuICAgICAgICAgICAgY291bnQgPj0gNSAmJiB0aGlzLmF1dGhlbnRpY2F0aW9uKCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBhdXRoZW50aWNhdGlvbigpIHtcclxuICAgICAgICAgICAgd3guc2hvd01vZGFsKHtcclxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6ICfnlLPor7fmiJDkuLrnpL7ljLrnrqHnkIblkZg/JyxcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6ICh7Y29uZmlybX0pID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZihjb25maXJtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3Qoe3VybDogJy9hcGkvdXNlci9jb21tdW5pdHlBdXRob3JpemF0aW9uJ30pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB3eC5zaG93VG9hc3Qoe3RpdGxlOiAn55Sz6K+35oiQ5YqfJ30pKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gdGhpcy5zZXREYXRhKHtoYXNDb21tb2RpdHk6IGZhbHNlfSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goY29uc29sZS5sb2cpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBjb21wbGV0ZTogKCkgPT4gdGhpcy5kYXRhLmNvdW50ID0gdGhpcy5kYXRhLnRpbWUgPSAwXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSk7XHJcbiJdfQ==