"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var http_1 = require("../../../utils/http");
var util_1 = require("../../../utils/util");
var index_1 = require("../../../constant/index");
Page({
    activity: null,
    goods: null,
    data: {
        history: [],
        type: '',
        tabType: 0
    },
    onLoad: function (query) {
        this.data.type = query.type;
        var type = "_" + query.type;
        this[type] && this[type]();
        var titles = {
            await: '待参加',
            auditing: '待审核',
            complete: '已参加',
            evaluate: '待评价',
            initiate: '我的发起',
            collection: '我的收藏'
        };
        wx.setNavigationBarTitle({
            title: titles[query.type]
        });
    },
    delete: function (e) {
        var _this = this;
        var index = +e.target.dataset.index;
        var history = this.data.history;
        wx.showModal({
            content: this.data.type === 'collection' ? '取消收藏？' : '删除该活动？',
            success: function (res) {
                if (res.confirm) {
                    if (_this.data.type === 'collection') {
                        return _this._cancelCollect(index);
                    }
                    http_1.request({
                        url: '/api/activity',
                        method: 'DELETE',
                        data: { activityId: history[index].id }
                    })
                        .then(function () {
                        wx.showToast({ title: '删除成功' });
                        history.splice(index, 1);
                        _this.setData({ history: history });
                    })
                        .catch(console.log);
                }
            }
        });
    },
    openEnList: function (e) {
        var index = +e.target.dataset.index;
        var enList = this.selectComponent('#en-list');
        enList.show(this.data.history[index].id);
    },
    ok: function (e) {
        var _this = this;
        wx.showModal({
            content: '该活动已完成?',
            success: function (res) {
                if (res.confirm) {
                    var index_2 = +e.target.dataset.index;
                    var history_1 = _this.data.history;
                    http_1.request({ url: '/api/activity/achieve/' + history_1[index_2].id })
                        .then(function () {
                        wx.showToast({ title: '操作成功' });
                        history_1[index_2].status = index_1.ActiveStatus.complete;
                        _this.setData({ history: history_1 });
                    })
                        .catch(console.log);
                }
            }
        });
    },
    none: function () {
    },
    switch: function (e) {
        var type = +e.target.dataset.type;
        this.data.tabType = type;
        var another = type ? this.goods : this.activity;
        if (another) {
            this.data.history = another;
            return this.setData(this.data);
        }
        this._collection();
    },
    _cancelCollect: function (index) {
        var _this = this;
        var history = this.data.history;
        http_1.request({
            url: '/api/like',
            method: 'DELETE',
            data: {
                targetId: history[index].id,
                type: this.data.tabType
            }
        })
            .then(function () {
            wx.showToast({ title: '取消搜藏成功' });
            history.splice(index, 1);
            _this.setData({ history: history });
        })
            .catch(console.log);
    },
    _await: function () {
        this._request('/api/activity/participation/list/await');
    },
    _auditing: function () {
        this._request('/api/activity/participation/list/auditing');
    },
    _complete: function () {
        this._request('/api/activity/participation/list/complete');
    },
    _evaluate: function () {
        this._request('/api/activity/participation/list/evaluate');
    },
    _initiate: function () {
        this._request('/api/activity/my');
    },
    _collection: function () {
        var _this = this;
        var tabType = this.data.tabType;
        http_1.request({
            url: '/api/like',
            data: { type: tabType }
        })
            .then(function (_a) {
            var data = _a.data;
            var list = data.map(util_1.parseData);
            _this[tabType ? 'goods' : 'activity'] = list;
            _this.setData({
                history: list,
                type: _this.data.type,
                tabType: tabType
            });
        })
            .catch(console.log);
    },
    _request: function (url) {
        var _this = this;
        http_1.request({ url: url })
            .then(function (_a) {
            var data = _a.data;
            return _this.setData({ type: _this.data.type, history: data.map(util_1.parseData) });
        })
            .catch(console.log);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGlzdG9yeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImhpc3RvcnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw0Q0FBOEM7QUFDOUMsNENBQWdEO0FBRWhELGlEQUF1RDtBQUl2RCxJQUFJLENBQUM7SUFDRCxRQUFRLEVBQW9CLElBQUk7SUFDaEMsS0FBSyxFQUF1QixJQUFJO0lBQ2hDLElBQUksRUFBRTtRQUNGLE9BQU8sRUFBRSxFQUFpQztRQUMxQyxJQUFJLEVBQUUsRUFBRTtRQUNSLE9BQU8sRUFBRSxDQUFDO0tBQ2I7SUFDRCxNQUFNLFlBQUMsS0FBaUI7UUFDcEIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQztRQUU1QixJQUFNLElBQUksR0FBZ0IsTUFBSSxLQUFLLENBQUMsSUFBTSxDQUFDO1FBQzNDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUUzQixJQUFNLE1BQU0sR0FBUTtZQUNoQixLQUFLLEVBQUUsS0FBSztZQUNaLFFBQVEsRUFBRSxLQUFLO1lBQ2YsUUFBUSxFQUFFLEtBQUs7WUFDZixRQUFRLEVBQUUsS0FBSztZQUNmLFFBQVEsRUFBRSxNQUFNO1lBQ2hCLFVBQVUsRUFBRSxNQUFNO1NBQ3JCLENBQUM7UUFDRixFQUFFLENBQUMscUJBQXFCLENBQUM7WUFDckIsS0FBSyxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDO1NBQzVCLENBQUMsQ0FBQztJQUNQLENBQUM7SUFDRCxNQUFNLFlBQUMsQ0FBZTtRQUF0QixpQkEwQkM7UUF6QkcsSUFBTSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUM7UUFDdEMsSUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7UUFFbEMsRUFBRSxDQUFDLFNBQVMsQ0FBQztZQUNULE9B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QixDQUFDO0NBQ0osQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmVxdWVzdCB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL2h0dHAnO1xyXG5pbXBvcnQgeyBwYXJzZURhdGEgfSBmcm9tICcuLi8uLi8uLi91dGlscy91dGlsJztcclxuaW1wb3J0IHsgRW5MaXN0IH0gZnJvbSAnLi4vLi4vLi4vY29tcG9uZW50cy9lbmxpc3QvZW5saXN0JztcclxuaW1wb3J0IHsgQWN0aXZlU3RhdHVzIH0gZnJvbSAnLi4vLi4vLi4vY29uc3RhbnQvaW5kZXgnO1xyXG5cclxudHlwZSBIaXN0b3J5VHlwZSA9ICdfYXdhaXQnIHwgJ19hdWRpdGluZycgfCAnX2NvbXBsZXRlJztcclxuXHJcblBhZ2Uoe1xyXG4gICAgYWN0aXZpdHk6IDxJQWN0aXZlW10gfCBudWxsPm51bGwsXHJcbiAgICBnb29kczogPElDb21tb2RpdHlbXSB8IG51bGw+bnVsbCxcclxuICAgIGRhdGE6IHtcclxuICAgICAgICBoaXN0b3J5OiBbXSBhcyBBcnJheTxJQWN0aXZlIHwgSUNvbW1vZGl0eT4sXHJcbiAgICAgICAgdHlwZTogJycsXHJcbiAgICAgICAgdGFiVHlwZTogMFxyXG4gICAgfSxcclxuICAgIG9uTG9hZChxdWVyeTogSUFueU9iamVjdCkge1xyXG4gICAgICAgIHRoaXMuZGF0YS50eXBlID0gcXVlcnkudHlwZTtcclxuXHJcbiAgICAgICAgY29uc3QgdHlwZSA9IDxIaXN0b3J5VHlwZT5gXyR7cXVlcnkudHlwZX1gO1xyXG4gICAgICAgIHRoaXNbdHlwZV0gJiYgdGhpc1t0eXBlXSgpO1xyXG5cclxuICAgICAgICBjb25zdCB0aXRsZXM6IGFueSA9IHtcclxuICAgICAgICAgICAgYXdhaXQ6ICflvoXlj4LliqAnLFxyXG4gICAgICAgICAgICBhdWRpdGluZzogJ+W+heWuoeaguCcsXHJcbiAgICAgICAgICAgIGNvbXBsZXRlOiAn5bey5Y+C5YqgJyxcclxuICAgICAgICAgICAgZXZhbHVhdGU6ICflvoXor4Tku7cnLFxyXG4gICAgICAgICAgICBpbml0aWF0ZTogJ+aIkeeahOWPkei1tycsXHJcbiAgICAgICAgICAgIGNvbGxlY3Rpb246ICfmiJHnmoTmlLbol48nXHJcbiAgICAgICAgfTtcclxuICAgICAgICB3eC5zZXROYXZpZ2F0aW9uQmFyVGl0bGUoe1xyXG4gICAgICAgICAgICB0aXRsZTogdGl0bGVzW3F1ZXJ5LnR5cGVdXHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZGVsZXRlKGU6IFd4VG91Y2hFdmVudCkge1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gK2UudGFyZ2V0LmRhdGFzZXQuaW5kZXg7XHJcbiAgICAgICAgY29uc3QgaGlzdG9yeSA9IHRoaXMuZGF0YS5oaXN0b3J5O1xyXG5cclxuICAgICAgICB3eC5zaG93TW9kYWwoe1xyXG4gICAgICAgICAgICBjb250ZW50OiB0aGlzLmRhdGEudHlwZSA9PT0gJ2NvbGxlY3Rpb24nID8gJ+WPlua2iOaUtuiXj++8nycgOiAn5Yig6Zmk6K+l5rS75Yqo77yfJyxcclxuICAgICAgICAgICAgc3VjY2VzczogKHJlcykgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlcy5jb25maXJtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGF0YS50eXBlID09PSAnY29sbGVjdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhbmNlbENvbGxlY3QoaW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogJy9hcGkvYWN0aXZpdHknLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7IGFjdGl2aXR5SWQ6IGhpc3RvcnlbaW5kZXhdLmlkIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3eC5zaG93VG9hc3QoeyB0aXRsZTogJ+WIoOmZpOaIkOWKnycgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaXN0b3J5LnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldERhdGEhKHsgaGlzdG9yeSB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGNvbnNvbGUubG9nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIG9wZW5Fbkxpc3QoZTogV3hUb3VjaEV2ZW50KSB7XHJcbiAgICAgICAgY29uc3QgaW5kZXggPSArZS50YXJnZXQuZGF0YXNldC5pbmRleDtcclxuICAgICAgICBjb25zdCBlbkxpc3QgPSA8RW5MaXN0PnRoaXMuc2VsZWN0Q29tcG9uZW50ISgnI2VuLWxpc3QnKTtcclxuXHJcbiAgICAgICAgZW5MaXN0LnNob3codGhpcy5kYXRhLmhpc3RvcnlbaW5kZXhdLmlkKTtcclxuICAgIH0sXHJcbiAgICBvayhlOiBXeFRvdWNoRXZlbnQpIHtcclxuICAgICAgICB3eC5zaG93TW9kYWwoe1xyXG4gICAgICAgICAgICBjb250ZW50OiAn6K+l5rS75Yqo5bey5a6M5oiQPycsXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IChyZXMpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXMuY29uZmlybSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gK2UudGFyZ2V0LmRhdGFzZXQuaW5kZXg7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaGlzdG9yeSA9IDxJQWN0aXZlW10+dGhpcy5kYXRhLmhpc3Rvcnk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3QoeyB1cmw6ICcvYXBpL2FjdGl2aXR5L2FjaGlldmUvJyArIGhpc3RvcnlbaW5kZXhdLmlkIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHd4LnNob3dUb2FzdCh7dGl0bGU6ICfmk43kvZzmiJDlip8nfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaXN0b3J5W2luZGV4XS5zdGF0dXMgPSBBY3RpdmVTdGF0dXMuY29tcGxldGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldERhdGEhKHtoaXN0b3J5fSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChjb25zb2xlLmxvZyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBub25lKCkge1xyXG4gICAgICAgIC8vXHJcbiAgICB9LFxyXG4gICAgc3dpdGNoKGU6IFd4VG91Y2hFdmVudCkge1xyXG4gICAgICAgIGNvbnN0IHR5cGUgPSArZS50YXJnZXQuZGF0YXNldC50eXBlO1xyXG4gICAgICAgIHRoaXMuZGF0YS50YWJUeXBlID0gdHlwZTtcclxuICAgICAgICBjb25zdCBhbm90aGVyID0gdHlwZSA/IHRoaXMuZ29vZHMgOiB0aGlzLmFjdGl2aXR5O1xyXG5cclxuICAgICAgICBpZiAoYW5vdGhlcikge1xyXG4gICAgICAgICAgICB0aGlzLmRhdGEuaGlzdG9yeSA9IGFub3RoZXI7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNldERhdGEhKHRoaXMuZGF0YSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9jb2xsZWN0aW9uKCk7XHJcbiAgICB9LFxyXG4gICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gICAgX2NhbmNlbENvbGxlY3QoaW5kZXg6IG51bWJlcikge1xyXG4gICAgICAgIGNvbnN0IGhpc3RvcnkgPSB0aGlzLmRhdGEuaGlzdG9yeTtcclxuXHJcbiAgICAgICAgcmVxdWVzdCh7XHJcbiAgICAgICAgICAgIHVybDogJy9hcGkvbGlrZScsXHJcbiAgICAgICAgICAgIG1ldGhvZDogJ0RFTEVURScsXHJcbiAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgIHRhcmdldElkOiBoaXN0b3J5W2luZGV4XS5pZCxcclxuICAgICAgICAgICAgICAgIHR5cGU6IHRoaXMuZGF0YS50YWJUeXBlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB3eC5zaG93VG9hc3QoeyB0aXRsZTogJ+WPlua2iOaQnOiXj+aIkOWKnycgfSk7XHJcbiAgICAgICAgICAgICAgICBoaXN0b3J5LnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldERhdGEhKHsgaGlzdG9yeSB9KTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKGNvbnNvbGUubG9nKTtcclxuICAgIH0sXHJcbiAgICBfYXdhaXQoKSB7XHJcbiAgICAgICAgdGhpcy5fcmVxdWVzdCgnL2FwaS9hY3Rpdml0eS9wYXJ0aWNpcGF0aW9uL2xpc3QvYXdhaXQnKTtcclxuICAgIH0sXHJcbiAgICBfYXVkaXRpbmcoKSB7XHJcbiAgICAgICAgdGhpcy5fcmVxdWVzdCgnL2FwaS9hY3Rpdml0eS9wYXJ0aWNpcGF0aW9uL2xpc3QvYXVkaXRpbmcnKTtcclxuICAgIH0sXHJcbiAgICBfY29tcGxldGUoKSB7XHJcbiAgICAgICAgdGhpcy5fcmVxdWVzdCgnL2FwaS9hY3Rpdml0eS9wYXJ0aWNpcGF0aW9uL2xpc3QvY29tcGxldGUnKTtcclxuICAgIH0sXHJcbiAgICBfZXZhbHVhdGUoKSB7XHJcbiAgICAgICAgdGhpcy5fcmVxdWVzdCgnL2FwaS9hY3Rpdml0eS9wYXJ0aWNpcGF0aW9uL2xpc3QvZXZhbHVhdGUnKTtcclxuICAgIH0sXHJcbiAgICBfaW5pdGlhdGUoKSB7XHJcbiAgICAgICAgdGhpcy5fcmVxdWVzdCgnL2FwaS9hY3Rpdml0eS9teScpO1xyXG4gICAgfSxcclxuICAgIF9jb2xsZWN0aW9uKCkge1xyXG4gICAgICAgIGNvbnN0IHRhYlR5cGUgPSB0aGlzLmRhdGEudGFiVHlwZTtcclxuICAgICAgICByZXF1ZXN0PElDb21tb2RpdHlbXSB8IElBY3RpdmVbXT4oe1xyXG4gICAgICAgICAgICB1cmw6ICcvYXBpL2xpa2UnLFxyXG4gICAgICAgICAgICBkYXRhOiB7IHR5cGU6IHRhYlR5cGUgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgIC50aGVuKCh7IGRhdGEgfSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgbGlzdCA9ICg8YW55W10+ZGF0YSkubWFwKHBhcnNlRGF0YSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzW3RhYlR5cGUgPyAnZ29vZHMnIDogJ2FjdGl2aXR5J10gPSBsaXN0O1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXREYXRhISh7XHJcbiAgICAgICAgICAgICAgICAgICAgaGlzdG9yeTogbGlzdCxcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiB0aGlzLmRhdGEudHlwZSxcclxuICAgICAgICAgICAgICAgICAgICB0YWJUeXBlXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKGNvbnNvbGUubG9nKTtcclxuICAgIH0sXHJcbiAgICBfcmVxdWVzdCh1cmw6IHN0cmluZykge1xyXG4gICAgICAgIHJlcXVlc3Q8SUFjdGl2ZVtdPih7IHVybCB9KVxyXG4gICAgICAgICAgICAudGhlbigoeyBkYXRhIH0pID0+IHRoaXMuc2V0RGF0YSEoeyB0eXBlOiB0aGlzLmRhdGEudHlwZSwgaGlzdG9yeTogZGF0YS5tYXAocGFyc2VEYXRhKSB9KSlcclxuICAgICAgICAgICAgLmNhdGNoKGNvbnNvbGUubG9nKTtcclxuICAgIH1cclxufSk7XHJcbiJdfQ==