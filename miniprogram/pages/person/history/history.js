"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var http_1 = require("../../../utils/http");
var util_1 = require("../../../utils/util");
Page({
    data: {
        history: [],
        type: '',
        tabType: 0,
        another: []
    },
    onLoad: function (query) {
        this.data.type = query.type;
        var type = "_" + query.type;
        this[type] && this[type]();
        var titles = {
            await: '待参加',
            auditing: '待审核',
            complete: '已参加',
            evaluate: '待评价',
            initiate: '我的发起',
            collection: '我的收藏'
        };
        wx.setNavigationBarTitle({
            title: titles[query.type]
        });
    },
    delete: function (e) {
        var _this = this;
        var index = +e.target.dataset.index;
        var history = this.data.history;
        wx.showModal({
            content: this.data.type === 'collection' ? '取消收藏？' : '删除该活动？',
            success: function (res) {
                if (res.confirm) {
                    if (_this.data.type === 'collection') {
                        return _this._cancelCollect(index);
                    }
                    http_1.request({
                        url: '/api/activity',
                        method: 'DELETE',
                        data: { activityId: history[index].id }
                    })
                        .then(function () {
                        wx.showToast({ title: '删除成功' });
                        history.splice(index, 1);
                        _this.setData({ history: history });
                    })
                        .catch(console.log);
                }
            }
        });
    },
    none: function () {
    },
    switch: function (e) {
        this.data.tabType = +e.target.dataset.type;
        var another = this.data.another;
        this.data.another = this.data.history;
        if (another.length) {
            this.data.history = another;
            return this.setData(this.data);
        }
        this._collection();
    },
    _cancelCollect: function (index) {
        var _this = this;
        var history = this.data.history;
        http_1.request({
            url: '/api/like',
            method: 'DELETE',
            data: {
                targetId: history[index].id,
                type: this.data.tabType
            }
        })
            .then(function () {
            wx.showToast({ title: '取消搜藏成功' });
            history.splice(index, 1);
            _this.setData({ history: history });
        })
            .catch(console.log);
    },
    _await: function () {
        this._request('/api/activity/participation/list/await');
    },
    _auditing: function () {
        this._request('/api/activity/participation/list/auditing');
    },
    _complete: function () {
        this._request('/api/activity/participation/list/complete');
    },
    _evaluate: function () {
        this._request('/api/activity/participation/list/evaluate');
    },
    _initiate: function () {
        this._request('/api/activity/my');
    },
    _collection: function () {
        var _this = this;
        http_1.request({
            url: '/api/like',
            data: { type: this.data.tabType }
        })
            .then(function (_a) {
            var data = _a.data;
            return _this.setData({
                history: data.map(util_1.parseData),
                type: _this.data.type,
                tabType: _this.data.tabType
            });
        })
            .catch(console.log);
    },
    _request: function (url) {
        var _this = this;
        http_1.request({ url: url })
            .then(function (_a) {
            var data = _a.data;
            return _this.setData({ type: _this.data.type, history: data.map(util_1.parseData) });
        })
            .catch(console.log);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGlzdG9yeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImhpc3RvcnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw0Q0FBOEM7QUFDOUMsNENBQWdEO0FBSWhELElBQUksQ0FBQztJQUNELElBQUksRUFBRTtRQUNGLE9BQU8sRUFBRSxFQUFpQztRQUMxQyxJQUFJLEVBQUUsRUFBRTtRQUNSLE9BQU8sRUFBRSxDQUFDO1FBQ1YsT0FBTyxFQUErQixFQUFFO0tBQzNDO0lBQ0QsTUFBTSxZQUFDLEtBQWlCO1FBQ3BCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUM7UUFFNUIsSUFBTSxJQUFJLEdBQWdCLE1BQUksS0FBSyxDQUFDLElBQU0sQ0FBQztRQUMzQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7UUFFM0IsSUFBTSxNQUFNLEdBQVE7WUFDaEIsS0FBSyxFQUFFLEtBQUs7WUFDWixRQUFRLEVBQUUsS0FBSztZQUNmLFFBQVEsRUFBRSxLQUFLO1lBQ2YsUUFBUSxFQUFFLEtBQUs7WUFDZixRQUFRLEVBQUUsTUFBTTtZQUNoQixVQUFVLEVBQUUsTUFBTTtTQUNyQixDQUFDO1FBQ0YsRUFBRSxDQUFDLHFCQUFxQixDQUFDO1lBQ3JCLEtBQUssRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQztTQUM1QixDQUFDLENBQUM7SUFDUCxDQUFDO0lBQ0QsTUFBTSxZQUFDLENBQWU7UUFBdEIsaUJBMEJDO1FBekJHLElBQU0sS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDO1FBQ3RDLElBQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDO1FBRWxDLEVBQUUsQ0FBQyxTQUFTLENBQUM7WUFDVCxPQUFPLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEtB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QUM7SUFDL0QsQ0FBQztJQUNELFNBQVM7UUFDTCxJQUFJLENBQUMsUUFBUSxDQUFDLGtCQUFrQixDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUNELFdBQVc7UUFBWCxpQkFXQztRQVZHLGNBQU8sQ0FBMkI7WUFDOUIsR0FBRyxFQUFFLFdBQVc7WUFDaEIsSUFBSSxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO1NBQ3BDLENBQUM7YUFDRyxJQUFJLENBQUMsVUFBQyxFQUFRO2dCQUFOLGNBQUk7WUFBTyxPQUFBLEtBQUksQ0FBQyxPQUFRLENBQUM7Z0JBQzlCLE9BQU8sRUFBVSxJQUFLLENBQUMsR0FBRyxDQUFDLGdCQUFTLENBQUM7Z0JBQ3JDLElBQUksRUFBRSxLQUFJLENBQUMsSUFBSSxDQUFDLElBQUk7Z0JBQ3BCLE9BQU8sRUFBRSxLQUFJLENBQUMsSUFBSSxDQUFDLE9BQU87YUFDN0IsQ0FBQztRQUprQixDQUlsQixDQUFDO2FBQ0YsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBQ0QsUUFBUSxZQUFDLEdBQVc7UUFBcEIsaUJBSUM7UUFIRyxjQUFPLENBQVksRUFBRSxHQUFHLEtBQUEsRUFBRSxDQUFDO2FBQ3RCLElBQUksQ0FBQyxVQUFDLEVBQVE7Z0JBQU4sY0FBSTtZQUFPLE9BQUEsS0FBSSxDQUFDLE9BQVEsQ0FBQyxFQUFFLElBQUksRUFBRSxLQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxnQkFBUyxDQUFDLEVBQUUsQ0FBQztRQUFyRSxDQUFxRSxDQUFDO2FBQ3pGLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDNUIsQ0FBQztDQUNKLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHJlcXVlc3QgfSBmcm9tICcuLi8uLi8uLi91dGlscy9odHRwJztcclxuaW1wb3J0IHsgcGFyc2VEYXRhIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvdXRpbCc7XHJcblxyXG50eXBlIEhpc3RvcnlUeXBlID0gJ19hd2FpdCcgfCAnX2F1ZGl0aW5nJyB8ICdfY29tcGxldGUnO1xyXG5cclxuUGFnZSh7XHJcbiAgICBkYXRhOiB7XHJcbiAgICAgICAgaGlzdG9yeTogW10gYXMgQXJyYXk8SUFjdGl2ZSB8IElDb21tb2RpdHk+LFxyXG4gICAgICAgIHR5cGU6ICcnLFxyXG4gICAgICAgIHRhYlR5cGU6IDAsXHJcbiAgICAgICAgYW5vdGhlcjogPEFycmF5PElBY3RpdmUgfCBJQ29tbW9kaXR5Pj5bXVxyXG4gICAgfSxcclxuICAgIG9uTG9hZChxdWVyeTogSUFueU9iamVjdCkge1xyXG4gICAgICAgIHRoaXMuZGF0YS50eXBlID0gcXVlcnkudHlwZTtcclxuXHJcbiAgICAgICAgY29uc3QgdHlwZSA9IDxIaXN0b3J5VHlwZT5gXyR7cXVlcnkudHlwZX1gO1xyXG4gICAgICAgIHRoaXNbdHlwZV0gJiYgdGhpc1t0eXBlXSgpO1xyXG5cclxuICAgICAgICBjb25zdCB0aXRsZXM6IGFueSA9IHtcclxuICAgICAgICAgICAgYXdhaXQ6ICflvoXlj4LliqAnLFxyXG4gICAgICAgICAgICBhdWRpdGluZzogJ+W+heWuoeaguCcsXHJcbiAgICAgICAgICAgIGNvbXBsZXRlOiAn5bey5Y+C5YqgJyxcclxuICAgICAgICAgICAgZXZhbHVhdGU6ICflvoXor4Tku7cnLFxyXG4gICAgICAgICAgICBpbml0aWF0ZTogJ+aIkeeahOWPkei1tycsXHJcbiAgICAgICAgICAgIGNvbGxlY3Rpb246ICfmiJHnmoTmlLbol48nXHJcbiAgICAgICAgfTtcclxuICAgICAgICB3eC5zZXROYXZpZ2F0aW9uQmFyVGl0bGUoe1xyXG4gICAgICAgICAgICB0aXRsZTogdGl0bGVzW3F1ZXJ5LnR5cGVdXHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZGVsZXRlKGU6IFd4VG91Y2hFdmVudCkge1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gK2UudGFyZ2V0LmRhdGFzZXQuaW5kZXg7XHJcbiAgICAgICAgY29uc3QgaGlzdG9yeSA9IHRoaXMuZGF0YS5oaXN0b3J5O1xyXG5cclxuICAgICAgICB3eC5zaG93TW9kYWwoe1xyXG4gICAgICAgICAgICBjb250ZW50OiB0aGlzLmRhdGEudHlwZSA9PT0gJ2NvbGxlY3Rpb24nID8gJ+WPlua2iOaUtuiXj++8nycgOiAn5Yig6Zmk6K+l5rS75Yqo77yfJyxcclxuICAgICAgICAgICAgc3VjY2VzczogKHJlcykgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlcy5jb25maXJtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGF0YS50eXBlID09PSAnY29sbGVjdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhbmNlbENvbGxlY3QoaW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogJy9hcGkvYWN0aXZpdHknLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7IGFjdGl2aXR5SWQ6IGhpc3RvcnlbaW5kZXhdLmlkIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3eC5zaG93VG9hc3QoeyB0aXRsZTogJ+WIoOmZpOaIkOWKnycgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoaXN0b3J5LnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldERhdGEhKHsgaGlzdG9yeSB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGNvbnNvbGUubG9nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIG5vbmUoKSB7XHJcbiAgICAgICAgLy9cclxuICAgIH0sXHJcbiAgICBzd2l0Y2goZTogV3hUb3VjaEV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5kYXRhLnRhYlR5cGUgPSArZS50YXJnZXQuZGF0YXNldC50eXBlO1xyXG4gICAgICAgIGNvbnN0IGFub3RoZXIgPSB0aGlzLmRhdGEuYW5vdGhlcjtcclxuICAgICAgICB0aGlzLmRhdGEuYW5vdGhlciA9IHRoaXMuZGF0YS5oaXN0b3J5O1xyXG5cclxuICAgICAgICBpZiAoYW5vdGhlci5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhLmhpc3RvcnkgPSBhbm90aGVyO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZXREYXRhISh0aGlzLmRhdGEpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fY29sbGVjdGlvbigpO1xyXG4gICAgfSxcclxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAgIF9jYW5jZWxDb2xsZWN0KGluZGV4OiBudW1iZXIpIHtcclxuICAgICAgICBjb25zdCBoaXN0b3J5ID0gdGhpcy5kYXRhLmhpc3Rvcnk7XHJcblxyXG4gICAgICAgIHJlcXVlc3Qoe1xyXG4gICAgICAgICAgICB1cmw6ICcvYXBpL2xpa2UnLFxyXG4gICAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXRJZDogaGlzdG9yeVtpbmRleF0uaWQsXHJcbiAgICAgICAgICAgICAgICB0eXBlOiB0aGlzLmRhdGEudGFiVHlwZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgd3guc2hvd1RvYXN0KHsgdGl0bGU6ICflj5bmtojmkJzol4/miJDlip8nIH0pO1xyXG4gICAgICAgICAgICAgICAgaGlzdG9yeS5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXREYXRhISh7IGhpc3RvcnkgfSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChjb25zb2xlLmxvZyk7XHJcbiAgICB9LFxyXG4gICAgX2F3YWl0KCkge1xyXG4gICAgICAgIHRoaXMuX3JlcXVlc3QoJy9hcGkvYWN0aXZpdHkvcGFydGljaXBhdGlvbi9saXN0L2F3YWl0Jyk7XHJcbiAgICB9LFxyXG4gICAgX2F1ZGl0aW5nKCkge1xyXG4gICAgICAgIHRoaXMuX3JlcXVlc3QoJy9hcGkvYWN0aXZpdHkvcGFydGljaXBhdGlvbi9saXN0L2F1ZGl0aW5nJyk7XHJcbiAgICB9LFxyXG4gICAgX2NvbXBsZXRlKCkge1xyXG4gICAgICAgIHRoaXMuX3JlcXVlc3QoJy9hcGkvYWN0aXZpdHkvcGFydGljaXBhdGlvbi9saXN0L2NvbXBsZXRlJyk7XHJcbiAgICB9LFxyXG4gICAgX2V2YWx1YXRlKCkge1xyXG4gICAgICAgIHRoaXMuX3JlcXVlc3QoJy9hcGkvYWN0aXZpdHkvcGFydGljaXBhdGlvbi9saXN0L2V2YWx1YXRlJyk7XHJcbiAgICB9LFxyXG4gICAgX2luaXRpYXRlKCkge1xyXG4gICAgICAgIHRoaXMuX3JlcXVlc3QoJy9hcGkvYWN0aXZpdHkvbXknKTtcclxuICAgIH0sXHJcbiAgICBfY29sbGVjdGlvbigpIHtcclxuICAgICAgICByZXF1ZXN0PElDb21tb2RpdHlbXSB8IElBY3RpdmVbXT4oe1xyXG4gICAgICAgICAgICB1cmw6ICcvYXBpL2xpa2UnLFxyXG4gICAgICAgICAgICBkYXRhOiB7IHR5cGU6IHRoaXMuZGF0YS50YWJUeXBlIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgICAgICAudGhlbigoeyBkYXRhIH0pID0+IHRoaXMuc2V0RGF0YSEoe1xyXG4gICAgICAgICAgICAgICAgaGlzdG9yeTogKDxhbnlbXT5kYXRhKS5tYXAocGFyc2VEYXRhKSxcclxuICAgICAgICAgICAgICAgIHR5cGU6IHRoaXMuZGF0YS50eXBlLFxyXG4gICAgICAgICAgICAgICAgdGFiVHlwZTogdGhpcy5kYXRhLnRhYlR5cGVcclxuICAgICAgICAgICAgfSkpXHJcbiAgICAgICAgICAgIC5jYXRjaChjb25zb2xlLmxvZyk7XHJcbiAgICB9LFxyXG4gICAgX3JlcXVlc3QodXJsOiBzdHJpbmcpIHtcclxuICAgICAgICByZXF1ZXN0PElBY3RpdmVbXT4oeyB1cmwgfSlcclxuICAgICAgICAgICAgLnRoZW4oKHsgZGF0YSB9KSA9PiB0aGlzLnNldERhdGEhKHsgdHlwZTogdGhpcy5kYXRhLnR5cGUsIGhpc3Rvcnk6IGRhdGEubWFwKHBhcnNlRGF0YSkgfSkpXHJcbiAgICAgICAgICAgIC5jYXRjaChjb25zb2xlLmxvZyk7XHJcbiAgICB9XHJcbn0pO1xyXG4iXX0=