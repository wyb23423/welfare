"use strict";
Component({
    properties: {
        height: {
            type: String,
            value: '60vw'
        },
        initial: {
            type: Number,
            value: 0
        },
        interval: {
            type: Number,
            value: 3000
        }
    },
    data: {
        items: [],
        index: -1,
        label: [],
        sx: 0,
        ex: 0,
        isMoving: false,
        timer: 0
    },
    relations: {
        './item/item': {
            type: 'child',
            linked: function (target) {
                this._clearTimer();
                var _a = this.data, items = _a.items, label = _a.label;
                items.push(target);
                label.push(1);
                this._update();
            },
            unlinked: function (target) {
                this._clearTimer();
                var _a = this.data, items = _a.items, label = _a.label;
                var index = items.indexOf(target);
                index > -1 && items.splice(index, 1);
                label.pop();
                this._update();
            }
        }
    },
    detached: function () {
        this._clearTimer();
    },
    methods: {
        touchStart: function (_a) {
            var pageX = _a.touches[0].pageX;
            this.data.sx = pageX;
        },
        touchMove: function (_a) {
            var pageX = _a.touches[0].pageX;
            this.data.ex = pageX;
        },
        touchEnd: function () {
            var _a = this.data, sx = _a.sx, ex = _a.ex, length = _a.items.length, isMoving = _a.isMoving;
            if (length <= 2 || isMoving) {
                return;
            }
            if (sx < ex - 50) {
                this.prev();
            }
            else if (sx > ex + 50) {
                this.next();
            }
        },
        setActiveItem: function (nameOrIndex) {
            var _this = this;
            var _a = this.data, items = _a.items, preIndex = _a.index;
            if (items.length <= 1) {
                items[0] && items[0].setData({ translate: '0%' });
                preIndex !== 0 && this.setData({ index: 0 });
                return this;
            }
            var index = this._getIndex(nameOrIndex);
            if (index == null) {
                return console.warn("\u672A\u627E\u5230" + (typeof nameOrIndex === 'number' ? '索引' : 'name') + "\u4E3A" + nameOrIndex + "\u7684\u8F6E\u64AD\u7EC4\u4EF6");
            }
            this.setData({ index: index });
            var offset = Math.floor(items.length / 2);
            var arr = items.slice(index).concat(items.slice(0, index));
            arr = arr.slice(-offset).concat(arr.slice(0, arr.length - offset));
            setTimeout(function () {
                _this.data.isMoving = false;
                arr.length <= 2 && arr[0].setData({ translate: '100%' });
            }, 500);
            arr.forEach(function (v, i) { return v.setData({ translate: (i - offset) * 100 + "%" }); });
            this.data.isMoving = true;
            return this;
        },
        prev: function () {
            var _a = this.data, items = _a.items, index = _a.index;
            this._clearTimer().setActiveItem(index <= 0 ? items.length - 1 : index - 1)._loop();
            return this;
        },
        next: function () {
            var _a = this.data, items = _a.items, index = _a.index;
            this._clearTimer().setActiveItem(index >= items.length - 1 ? 0 : index + 1)._loop();
            return this;
        },
        _getIndex: function (nameOrIndex) {
            var items = this.data.items;
            if (typeof nameOrIndex === 'number') {
                if (nameOrIndex >= 0 && nameOrIndex <= items.length - 1) {
                    return nameOrIndex;
                }
            }
            else {
                var index = items.findIndex(function (v) { return v.data.name === nameOrIndex; });
                if (index > -1) {
                    return index;
                }
            }
            return void 0;
        },
        _loop: function () {
            var interval = this.data.interval;
            interval > 100 && (this.data.timer = setTimeout(this.next.bind(this), this.data.interval + 500));
            return this;
        },
        _clearTimer: function () {
            var timer = this.data.timer;
            if (timer) {
                clearTimeout(timer);
                this.data.timer = 0;
            }
            return this;
        },
        _update: function () {
            var _this = this;
            var _a = this.data, items = _a.items, initial = _a.initial, index = _a.index, label = _a.label;
            this.data.timer = setTimeout(function () {
                var active = index < 0 ? (initial > items.length - 1 ? 0 : Math.max(0, initial)) : index;
                _this.setActiveItem(active)._loop().setData({ label: label });
            });
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2Fyb3VzZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjYXJvdXNlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBNEJBLFNBQVMsQ0FBVztJQUNoQixVQUFVLEVBQUU7UUFDUixNQUFNLEVBQUU7WUFDSixJQUFJLEVBQUUsTUFBTTtZQUNaLEtBQUssRUFBRSxNQUFNO1NBQ2hCO1FBQ0QsT0FBTyxFQUFFO1lBQ0wsSUFBSSxFQUFFLE1BQU07WUFDWixLQUFLLEVBQUUsQ0FBQztTQUNYO1FBQ0QsUUFBUSxFQUFFO1lBQ04sSUFBSSxFQUFFLE1BQU07WUFDWixLQUFLLEVBQUUsSUFBSTtTQUNkO0tBQ0o7SUFDRCxJQUFJLEVBQUU7UUFDRixLQUFLLEVBQUUsRUFBRTtRQUNULEtBQUssRUFBRSxDQUFDLENBQUM7UUFDVCxLQUFLLEVBQUUsRUFBRTtRQUNULEVBQUUsRUFBRSxDQUFDO1FBQ0wsRUFBRSxFQUFFLENBQUM7UUFDTCxRQUFRLEVBQUUsS0FBSztRQUNmLEtBQUssRUFBRSxDQUFDO0tBQ1g7SUFDRCxTQUFTLEVBQUU7UUFDUCxhQUFhLEVBQUU7WUFDWCxJQUFJLEVBQUUsT0FBTztZQUNiLE1BQU0sWUFBaUIsTUFBbUI7Z0JBQ3RDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFFYixJQUFBLGNBQTBCLEVBQXpCLGdCQUFLLEVBQUUsZ0JBQWtCLENBQUM7Z0JBQ2pDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ25CLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBRWQsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ25CLENBQUM7WUFDRCxRQUFRLFlBQWlCLE1BQW1CO2dCQUN4QyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBRWIsSUFBQSxjQUEwQixFQUF6QixnQkFBSyxFQUFFLGdCQUFrQixDQUFDO2dCQUNqQyxJQUFNLEtBQUssR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFD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QUFDLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztnQkFDM0YsS0FBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBQyxLQUFLLE9BQUEsRUFBQyxDQUFDLENBQUM7WUFDeEQsQ0FBQyxDQUFDLENBQUM7UUFDUCxDQUFDO0tBQ0o7Q0FDSixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICog6L2u5pKtXHJcbiAqL1xyXG5cclxuaW50ZXJmYWNlIENhcm91c2VsIGV4dGVuZHMgV3hDb21wb25lbnQge1xyXG4gICAgZGF0YToge1xyXG4gICAgICAgIGxhYmVsOiBBcnJheTwxPjsgLy8g5Yib5bu65qCH6K6w55qE5pWw57uEXHJcbiAgICAgICAgaW5kZXg6IG51bWJlcjsgLy8g5b2T5YmN5pi+56S657uE5Lu257Si5byVXHJcblxyXG4gICAgICAgIGl0ZW1zOiBXeENvbXBvbmVudFtdOyAvLyDmu5rliqjnu4Tku7ZcclxuICAgICAgICB0aW1lcjogbnVtYmVyOyAvLyDlrprml7blmahpZFxyXG4gICAgICAgIHN4OiBudW1iZXI7IC8vIHRvdWNoU3RhcnQg55qEeOWdkOagh1xyXG4gICAgICAgIGV4OiBudW1iZXI7IC8vIHRvdWNoRW5kIOaXtueahHjlnZDmoIdcclxuICAgICAgICBpc01vdmluZzogYm9vbGVhbjtcclxuXHJcbiAgICAgICAgaW50ZXJ2YWw6IG51bWJlcjsgLy8g5a6a5pe25Zmo6LCD55So6Ze06ZqUXHJcbiAgICAgICAgaW5pdGlhbDogbnVtYmVyOyAvLyDliJ3lp4vmmL7npLrnmoTnu4Tku7bntKLlvJVcclxuICAgIH07XHJcbiAgICBzZXRBY3RpdmVJdGVtKG5hbWVPckluZGV4OiBzdHJpbmcgfCBudW1iZXIpOiBDYXJvdXNlbDtcclxuICAgIHByZXYoKTogQ2Fyb3VzZWw7XHJcbiAgICBuZXh0KCk6IENhcm91c2VsO1xyXG5cclxuICAgIF9nZXRJbmRleChuYW1lT3JJbmRleDogc3RyaW5nIHwgbnVtYmVyKTogbnVtYmVyIHwgdm9pZDtcclxuICAgIF9sb29wKCk6IENhcm91c2VsO1xyXG4gICAgX2NsZWFyVGltZXIoKTogQ2Fyb3VzZWw7XHJcbiAgICBfdXBkYXRlKCk6IHZvaWQ7XHJcbn1cclxuXHJcbkNvbXBvbmVudDxDYXJvdXNlbD4oe1xyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIGhlaWdodDoge1xyXG4gICAgICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIHZhbHVlOiAnNjB2dydcclxuICAgICAgICB9LFxyXG4gICAgICAgIGluaXRpYWw6IHtcclxuICAgICAgICAgICAgdHlwZTogTnVtYmVyLFxyXG4gICAgICAgICAgICB2YWx1ZTogMFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaW50ZXJ2YWw6IHtcclxuICAgICAgICAgICAgdHlwZTogTnVtYmVyLFxyXG4gICAgICAgICAgICB2YWx1ZTogMzAwMFxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBkYXRhOiB7XHJcbiAgICAgICAgaXRlbXM6IFtdLFxyXG4gICAgICAgIGluZGV4OiAtMSxcclxuICAgICAgICBsYWJlbDogW10sXHJcbiAgICAgICAgc3g6IDAsXHJcbiAgICAgICAgZXg6IDAsXHJcbiAgICAgICAgaXNNb3Zpbmc6IGZhbHNlLFxyXG4gICAgICAgIHRpbWVyOiAwXHJcbiAgICB9LFxyXG4gICAgcmVsYXRpb25zOiB7XHJcbiAgICAgICAgJy4vaXRlbS9pdGVtJzoge1xyXG4gICAgICAgICAgICB0eXBlOiAnY2hpbGQnLFxyXG4gICAgICAgICAgICBsaW5rZWQodGhpczogQ2Fyb3VzZWwsIHRhcmdldDogV3hDb21wb25lbnQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2NsZWFyVGltZXIoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCB7aXRlbXMsIGxhYmVsfSA9IHRoaXMuZGF0YTtcclxuICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2godGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgIGxhYmVsLnB1c2goMSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5fdXBkYXRlKCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHVubGlua2VkKHRoaXM6IENhcm91c2VsLCB0YXJnZXQ6IFd4Q29tcG9uZW50KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9jbGVhclRpbWVyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3Qge2l0ZW1zLCBsYWJlbH0gPSB0aGlzLmRhdGE7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IGl0ZW1zLmluZGV4T2YodGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgIGluZGV4ID4gLTEgJiYgaXRlbXMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgIGxhYmVsLnBvcCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIGRldGFjaGVkKHRoaXM6IENhcm91c2VsKSB7XHJcbiAgICAgICAgdGhpcy5fY2xlYXJUaW1lcigpO1xyXG4gICAgfSxcclxuICAgIG1ldGhvZHM6IHtcclxuICAgICAgICB0b3VjaFN0YXJ0KHt0b3VjaGVzOiBbe3BhZ2VYfV19OiBXeFRvdWNoRXZlbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhLnN4ID0gcGFnZVg7XHJcbiAgICAgICAgfSxcclxuICAgICAgICB0b3VjaE1vdmUoe3RvdWNoZXM6IFt7cGFnZVh9XX06IFd4VG91Y2hFdmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmRhdGEuZXggPSBwYWdlWDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRvdWNoRW5kKCkge1xyXG4gICAgICAgICAgICBjb25zdCB7c3gsIGV4LCBpdGVtczoge2xlbmd0aH0sIGlzTW92aW5nfSA9IHRoaXMuZGF0YTtcclxuXHJcbiAgICAgICAgICAgIC8vIOmhueebruaVsOS4jeWkp+S6jjIsIOaJi+WKqOa7muWKqOayoeS7gOS5iOWkquWkp+W/heimge+8jOS4jeWkhOeQhlxyXG4gICAgICAgICAgICBpZihsZW5ndGggPD0gMiB8fCBpc01vdmluZykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZihzeCA8IGV4IC0gNTApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucHJldigpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYoc3ggPiBleCArIDUwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm5leHQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0QWN0aXZlSXRlbShuYW1lT3JJbmRleDogc3RyaW5nIHwgbnVtYmVyKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHtpdGVtcywgaW5kZXg6IHByZUluZGV4fSA9IHRoaXMuZGF0YTtcclxuXHJcbiAgICAgICAgICAgIC8vIOWwj+S6juS4pOmhueS4jemcgOimgea7muWKqFxyXG4gICAgICAgICAgICBpZihpdGVtcy5sZW5ndGggPD0gMSkge1xyXG4gICAgICAgICAgICAgICAgaXRlbXNbMF0gJiYgaXRlbXNbMF0uc2V0RGF0YSh7dHJhbnNsYXRlOiAnMCUnfSk7XHJcbiAgICAgICAgICAgICAgICBwcmVJbmRleCAhPT0gMCAmJiB0aGlzLnNldERhdGEoe2luZGV4OiAwfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLl9nZXRJbmRleChuYW1lT3JJbmRleCk7XHJcbiAgICAgICAgICAgIGlmKGluZGV4ID09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb25zb2xlLndhcm4oXHJcbiAgICAgICAgICAgICAgICAgICAgYOacquaJvuWIsCR7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVvZiBuYW1lT3JJbmRleCA9PT0gJ251bWJlcicgPyAn57Si5byVJyA6ICduYW1lJ1xyXG4gICAgICAgICAgICAgICAgICAgIH3kuLoke25hbWVPckluZGV4feeahOi9ruaSree7hOS7tmBcclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7aW5kZXh9KTtcclxuICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gTWF0aC5mbG9vcihpdGVtcy5sZW5ndGggLyAyKTtcclxuICAgICAgICAgICAgbGV0IGFyciA9IFsuLi5pdGVtcy5zbGljZShpbmRleCksIC4uLml0ZW1zLnNsaWNlKDAsIGluZGV4KV07XHJcbiAgICAgICAgICAgIGFyciA9IFsuLi5hcnIuc2xpY2UoLW9mZnNldCksIC4uLmFyci5zbGljZSgwLCBhcnIubGVuZ3RoIC0gb2Zmc2V0KV07XHJcblxyXG4gICAgICAgICAgICAvLyDorr7nva7mu5rliqjliqjnlLvnu5PmnZ/lm57osINcclxuICAgICAgICAgICAgLy8gNTAwOiDmu5rliqjliqjnlLvnmoTml7bpl7RcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEuaXNNb3ZpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGFyci5sZW5ndGggPD0gMiAmJiBhcnJbMF0uc2V0RGF0YSh7dHJhbnNsYXRlOiAnMTAwJSd9KTtcclxuICAgICAgICAgICAgfSwgNTAwKTtcclxuXHJcbiAgICAgICAgICAgIGFyci5mb3JFYWNoKCh2LCBpKSA9PiB2LnNldERhdGEoe3RyYW5zbGF0ZTogYCR7KGkgLSBvZmZzZXQpICogMTAwfSVgfSkgKTtcclxuICAgICAgICAgICAgdGhpcy5kYXRhLmlzTW92aW5nID0gdHJ1ZTsgLy8g5rua5Yqo5Yqo55S75Lit5omL5Yqo5rua5Yqo5peg5pWIXHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9LFxyXG4gICAgICAgIHByZXYoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHtpdGVtcywgaW5kZXh9ID0gdGhpcy5kYXRhO1xyXG4gICAgICAgICAgICB0aGlzLl9jbGVhclRpbWVyKCkuc2V0QWN0aXZlSXRlbShpbmRleCA8PSAwID8gaXRlbXMubGVuZ3RoIC0gMSA6IGluZGV4IC0gMSkuX2xvb3AoKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbmV4dCgpIHtcclxuICAgICAgICAgICAgY29uc3Qge2l0ZW1zLCBpbmRleH0gPSB0aGlzLmRhdGE7XHJcbiAgICAgICAgICAgIHRoaXMuX2NsZWFyVGltZXIoKS5zZXRBY3RpdmVJdGVtKGluZGV4ID49IGl0ZW1zLmxlbmd0aCAtIDEgPyAwIDogaW5kZXggKyAxKS5fbG9vcCgpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBfZ2V0SW5kZXgobmFtZU9ySW5kZXg6IHN0cmluZyB8IG51bWJlcikge1xyXG4gICAgICAgICAgICBjb25zdCBpdGVtcyA9IHRoaXMuZGF0YS5pdGVtcztcclxuICAgICAgICAgICAgaWYodHlwZW9mIG5hbWVPckluZGV4ID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICAgICAgaWYobmFtZU9ySW5kZXggPj0gMCAmJiBuYW1lT3JJbmRleCA8PSBpdGVtcy5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hbWVPckluZGV4O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBpdGVtcy5maW5kSW5kZXgodiA9PiB2LmRhdGEubmFtZSA9PT0gbmFtZU9ySW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgaWYoaW5kZXggPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbmRleDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHZvaWQgMDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIF9sb29wKCkge1xyXG4gICAgICAgICAgICBjb25zdCBpbnRlcnZhbCA9IHRoaXMuZGF0YS5pbnRlcnZhbDtcclxuICAgICAgICAgICAgaW50ZXJ2YWwgPiAxMDAgJiYgKHRoaXMuZGF0YS50aW1lciA9IHNldFRpbWVvdXQodGhpcy5uZXh0LmJpbmQodGhpcyksIHRoaXMuZGF0YS5pbnRlcnZhbCArIDUwMCkpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBfY2xlYXJUaW1lcigpIHtcclxuICAgICAgICAgICAgY29uc3Qge3RpbWVyfSA9IHRoaXMuZGF0YTtcclxuICAgICAgICAgICAgaWYodGltZXIpIHtcclxuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lcik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEudGltZXIgPSAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9LFxyXG4gICAgICAgIF91cGRhdGUoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHtpdGVtcywgaW5pdGlhbCwgaW5kZXgsIGxhYmVsfSA9IHRoaXMuZGF0YTtcclxuICAgICAgICAgICAgdGhpcy5kYXRhLnRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhY3RpdmUgPSBpbmRleCA8IDAgPyAoaW5pdGlhbCA+IGl0ZW1zLmxlbmd0aCAtIDEgPyAwIDogTWF0aC5tYXgoMCwgaW5pdGlhbCkpIDogaW5kZXg7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldEFjdGl2ZUl0ZW0oYWN0aXZlKS5fbG9vcCgpLnNldERhdGEoe2xhYmVsfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSk7XHJcbiJdfQ==