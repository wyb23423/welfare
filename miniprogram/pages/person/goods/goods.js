"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
Object.defineProperty(exports, "__esModule", { value: true });
var http_1 = require("../../../utils/http");
var page_query_1 = require("../../../behavior/page_query");
var status_1 = require("../../../constant/status");
function updateStatus(component, index) {
    var data = component.data.list[index];
    if (data.status === status_1.GOODS_STATUS.AUDITING) {
        return wx.showToast({ icon: 'none', title: '商品审核中' });
    }
    var status = data.status === status_1.GOODS_STATUS.NORMAL ? status_1.GOODS_STATUS.SOLD_OUT : status_1.GOODS_STATUS.NORMAL;
    http_1.request({
        url: '/api/commodity',
        data: __assign({}, data, { status: status }),
        method: 'POST'
    })
        .then(function () {
        var _a;
        return component.setData((_a = {}, _a["list[" + index + "].status"] = status, _a));
    })
        .then(function () { return wx.showToast({ title: '操作成功' }); })
        .catch(console.log);
}
exports.updateStatus = updateStatus;
function deleteGoods(component, index) {
    var list = component.data.list;
    var data = list[index];
    wx.showModal({
        content: "\u5220\u9664\u5546\u54C1" + data.name + "?",
        success: function (_a) {
            var confirm = _a.confirm;
            if (!confirm) {
                return;
            }
            http_1.request({
                url: '/api/commodity',
                data: { id: data.id },
                method: 'DELETE'
            })
                .then(function () { return component.reflash(); })
                .then(function () { return wx.showToast({ title: '删除成功' }); })
                .catch(console.log);
        }
    });
}
exports.deleteGoods = deleteGoods;
Component({
    behaviors: [page_query_1.default],
    data: {
        url: '/api/commodity/my',
        STATUS: {
            AUDITING: status_1.GOODS_STATUS.AUDITING,
            NORMAL: status_1.GOODS_STATUS.NORMAL,
            SOLD_OUT: status_1.GOODS_STATUS.SOLD_OUT,
            CLOSE: status_1.GOODS_STATUS.CLOSE
        }
    },
    pageLifetimes: {
        show: function () {
            this.onShow();
        }
    },
    methods: {
        updateStatus: function (_a) {
            var index = _a.target.dataset.index;
            updateStatus(this, index);
        },
        delete: function (_a) {
            var index = _a.target.dataset.index;
            deleteGoods(this, index);
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ29vZHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJnb29kcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBSUEsNENBQThDO0FBQzlDLDJEQUFzRTtBQUN0RSxtREFBd0Q7QUFLeEQsU0FBZ0IsWUFBWSxDQUFDLFNBQXdCLEVBQUUsS0FBYTtJQUNoRSxJQUFNLElBQUksR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN4QyxJQUFHLElBQUksQ0FBQyxNQUFNLEtBQUsscUJBQVksQ0FBQyxRQUFRLEVBQUU7UUFDdEMsT0FBTyxFQUFFLENBQUMsU0FBUyxDQUFDLEVBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFDLENBQUMsQ0FBQztLQUN2RDtJQUNELElBQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLEtBQUsscUJBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLHFCQUFZLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxxQkFBWSxDQUFDLE1BQU0sQ0FBQztJQUVqRyxjQUFPLENBQUM7UUFDSixHQUFHLEVBQUUsZ0JBQWdCO1FBQ3JCLElBQUksZUFBTSxJQUFJLElBQUUsTUFBTSxRQUFBLEdBQUM7UUFDdkIsTUFBTSxFQUFFLE1BQU07S0FDakIsQ0FBQztTQUNHLElBQUksQ0FBQzs7UUFBTSxPQUFBLFNBQVMsQ0FBQyxPQUFPLFdBQUUsR0FBQyxVQUFRLEtBQUssYUFBVSxJQUFHLE1BQU0sTUFBRTtJQUF0RCxDQUFzRCxDQUFDO1NBQ2xFLElBQUksQ0FBQyxjQUFNLE9BQUEsRUFBRSxDQUFDLFNBQVMsQ0FBQyxFQUFDLEtBQUssRUFBRSxNQUFNLEVBQUMsQ0FBQyxFQUE3QixDQUE2QixDQUFDO1NBQ3pDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDNUIsQ0FBQztBQWZELG9DQWVDO0FBS0QsU0FBZ0IsV0FBVyxDQUFDLFNBQXdCLEVBQUUsS0FBYTtJQUMvRCxJQUFNLElBQUksR0FBaUIsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDL0MsSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3pCLEVBQUUsQ0FBQyxTQUFTLENBQUM7UUFDVCxPQUFPLEVBQUUsNkJBQU8sSUFBSSxDQUFDLElBQUksTUFBRztRQUM1QixPQUFPLEVBQUUsVUFBQyxFQUFTO2dCQUFSLG9CQUFPO1lBQ2QsSUFBRyxDQUFDLE9BQU8sRUFBRTtnQkFDVCxPQUFPO2FBQ1Y7WUFFRCxjQUFPLENBQUM7Z0JBQ0osR0FBRyxFQUFFLGdCQUFnQjtnQkFDckIsSUFBSSxFQUFFLEVBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUM7Z0JBQ25CLE1BQU0sRUFBRSxRQUFRO2FBQ25CLENBQUM7aUJBQ0csSUFBSSxDQUFDLGNBQU0sT0FBQSxTQUFTLENBQUMsT0FBTyxFQUFFLEVBQW5CLENBQW1CLENBQUM7aUJBQy9CLElBQUksQ0FBQyxjQUFNLE9BQUEsRUFBRSxDQUFDLFNBQVMsQ0FBQyxFQUFDLEtBQUssRUFBRSxNQUFNLEVBQUMsQ0FBQyxFQUE3QixDQUE2QixDQUFDO2lCQUN6QyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzVCLENBQUM7S0FDSixDQUFDLENBQUM7QUFDUCxDQUFDO0FBcEJELGtDQW9CQztBQUdELFNBQVMsQ0FBZ0I7SUFDckIsU0FBUyxFQUFFLENBQUMsb0JBQVMsQ0FBQztJQUN0QixJQUFJLEVBQUU7UUFDRixHQUFHLEVBQUUsbUJBQW1CO1FBQ3hCLE1BQU0sRUFBRTtZQUNKLFFBQVEsRUFBRSxxQkFBWSxDQUFDLFFBQVE7WUFDL0IsTUFBTSxFQUFFLHFCQUFZLENBQUMsTUFBTTtZQUMzQixRQUFRLEVBQUUscUJBQVksQ0FBQyxRQUFRO1lBQy9CLEtBQUssRUFBRSxxQkFBWSxDQUFDLEtBQUs7U0FDNUI7S0FDSjtJQUNELGFBQWEsRUFBRTtRQUNYLElBQUk7WUFDQSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDbEIsQ0FBQztLQUNKO0lBQ0QsT0FBTyxFQUFFO1FBQ0wsWUFBWSxZQUFDLEVBQXdEO2dCQUFwQywrQkFBSztZQUNsQyxZQUFZLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzlCLENBQUM7UUFDRCxNQUFNLFlBQUMsRUFBd0Q7Z0JBQXBDLCtCQUFLO1lBQzVCLFdBQVcsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDN0IsQ0FBQztLQUNKO0NBQ0osQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIOaIkeeahOWVhuWTgVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IHJlcXVlc3QgfSBmcm9tICcuLi8uLi8uLi91dGlscy9odHRwJztcclxuaW1wb3J0IFBhZ2VRdWVyeSwge0xpc3RDb21wb25lbnR9IGZyb20gJy4uLy4uLy4uL2JlaGF2aW9yL3BhZ2VfcXVlcnknO1xyXG5pbXBvcnQgeyBHT09EU19TVEFUVVMgfSBmcm9tICcuLi8uLi8uLi9jb25zdGFudC9zdGF0dXMnO1xyXG5cclxuLyoqXHJcbiAqIOabtOaWsOWVhuWTgeeKtuaAgVxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVN0YXR1cyhjb21wb25lbnQ6IExpc3RDb21wb25lbnQsIGluZGV4OiBudW1iZXIpIHtcclxuICAgIGNvbnN0IGRhdGEgPSBjb21wb25lbnQuZGF0YS5saXN0W2luZGV4XTtcclxuICAgIGlmKGRhdGEuc3RhdHVzID09PSBHT09EU19TVEFUVVMuQVVESVRJTkcpIHtcclxuICAgICAgICByZXR1cm4gd3guc2hvd1RvYXN0KHtpY29uOiAnbm9uZScsIHRpdGxlOiAn5ZWG5ZOB5a6h5qC45LitJ30pO1xyXG4gICAgfVxyXG4gICAgY29uc3Qgc3RhdHVzID0gZGF0YS5zdGF0dXMgPT09IEdPT0RTX1NUQVRVUy5OT1JNQUwgPyBHT09EU19TVEFUVVMuU09MRF9PVVQgOiBHT09EU19TVEFUVVMuTk9STUFMO1xyXG5cclxuICAgIHJlcXVlc3Qoe1xyXG4gICAgICAgIHVybDogJy9hcGkvY29tbW9kaXR5JyxcclxuICAgICAgICBkYXRhOiB7Li4uZGF0YSwgc3RhdHVzfSxcclxuICAgICAgICBtZXRob2Q6ICdQT1NUJ1xyXG4gICAgfSlcclxuICAgICAgICAudGhlbigoKSA9PiBjb21wb25lbnQuc2V0RGF0YSh7W2BsaXN0WyR7aW5kZXh9XS5zdGF0dXNgXTogc3RhdHVzfSkpXHJcbiAgICAgICAgLnRoZW4oKCkgPT4gd3guc2hvd1RvYXN0KHt0aXRsZTogJ+aTjeS9nOaIkOWKnyd9KSlcclxuICAgICAgICAuY2F0Y2goY29uc29sZS5sb2cpO1xyXG59XHJcblxyXG4vKipcclxuICog5Yig6Zmk5ZWG5ZOBXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZGVsZXRlR29vZHMoY29tcG9uZW50OiBMaXN0Q29tcG9uZW50LCBpbmRleDogbnVtYmVyKSB7XHJcbiAgICBjb25zdCBsaXN0OiBJQ29tbW9kaXR5W10gPSBjb21wb25lbnQuZGF0YS5saXN0O1xyXG4gICAgY29uc3QgZGF0YSA9IGxpc3RbaW5kZXhdO1xyXG4gICAgd3guc2hvd01vZGFsKHtcclxuICAgICAgICBjb250ZW50OiBg5Yig6Zmk5ZWG5ZOBJHtkYXRhLm5hbWV9P2AsXHJcbiAgICAgICAgc3VjY2VzczogKHtjb25maXJtfSkgPT4ge1xyXG4gICAgICAgICAgICBpZighY29uZmlybSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXF1ZXN0KHtcclxuICAgICAgICAgICAgICAgIHVybDogJy9hcGkvY29tbW9kaXR5JyxcclxuICAgICAgICAgICAgICAgIGRhdGE6IHtpZDogZGF0YS5pZH0sXHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiBjb21wb25lbnQucmVmbGFzaCgpKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gd3guc2hvd1RvYXN0KHt0aXRsZTogJ+WIoOmZpOaIkOWKnyd9KSlcclxuICAgICAgICAgICAgICAgIC5jYXRjaChjb25zb2xlLmxvZyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn1cclxuXHJcblxyXG5Db21wb25lbnQ8TGlzdENvbXBvbmVudD4oe1xyXG4gICAgYmVoYXZpb3JzOiBbUGFnZVF1ZXJ5XSxcclxuICAgIGRhdGE6IHtcclxuICAgICAgICB1cmw6ICcvYXBpL2NvbW1vZGl0eS9teScsXHJcbiAgICAgICAgU1RBVFVTOiB7XHJcbiAgICAgICAgICAgIEFVRElUSU5HOiBHT09EU19TVEFUVVMuQVVESVRJTkcsXHJcbiAgICAgICAgICAgIE5PUk1BTDogR09PRFNfU1RBVFVTLk5PUk1BTCxcclxuICAgICAgICAgICAgU09MRF9PVVQ6IEdPT0RTX1NUQVRVUy5TT0xEX09VVCxcclxuICAgICAgICAgICAgQ0xPU0U6IEdPT0RTX1NUQVRVUy5DTE9TRVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBwYWdlTGlmZXRpbWVzOiB7XHJcbiAgICAgICAgc2hvdyh0aGlzOiBMaXN0Q29tcG9uZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMub25TaG93KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIG1ldGhvZHM6IHtcclxuICAgICAgICB1cGRhdGVTdGF0dXMoe3RhcmdldDoge2RhdGFzZXQ6IHtpbmRleH19fTogQmFzZUV2ZW50PHtpbmRleDogbnVtYmVyfT4pIHtcclxuICAgICAgICAgICAgdXBkYXRlU3RhdHVzKHRoaXMsIGluZGV4KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGRlbGV0ZSh7dGFyZ2V0OiB7ZGF0YXNldDoge2luZGV4fX19OiBCYXNlRXZlbnQ8e2luZGV4OiBudW1iZXJ9Pikge1xyXG4gICAgICAgICAgICBkZWxldGVHb29kcyh0aGlzLCBpbmRleCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KTtcclxuIl19