"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var status_1 = require("../../../../constant/status");
var http_1 = require("../../../../utils/http");
Page({
    id: 0,
    data: {
        auditing: [],
        join: [],
        refuse: [],
        STATUS: {
            AUDITING: status_1.SIGN_STATUS.AUDITING,
            AWAIT: status_1.SIGN_STATUS.AWAIT,
            JOINING: status_1.SIGN_STATUS.JOINING,
            REFUSE: status_1.SIGN_STATUS.REFUSE
        }
    },
    onLoad: function (query) {
        var _this = this;
        var activityId = this.id = +query.id;
        http_1.request({
            url: '/api/activity/participation/auditList',
            data: { activityId: activityId }
        })
            .then(function (_a) {
            var list = _a.data;
            var auditing = [];
            var refuse = [];
            var join = [];
            list.forEach(function (v) {
                if (v.status === status_1.SIGN_STATUS.AUDITING) {
                    auditing.push(v);
                }
                else if (v.status === status_1.SIGN_STATUS.REFUSE) {
                    refuse.push(v);
                }
                else {
                    join.push(v);
                }
            });
            _this.setData({ refuse: refuse, auditing: auditing, join: join });
        })
            .catch(console.log);
    },
    doSign: function (_a) {
        var _this = this;
        var index = _a.currentTarget.dataset.index;
        var item = this.data.join[index];
        if (!item) {
            return;
        }
        wx.showModal({
            title: item.name,
            content: '活动签到确认',
            success: function (_a) {
                var confirm = _a.confirm;
                var _b;
                if (confirm) {
                    _this.setData((_b = {},
                        _b["join[" + index + "].status"] = status_1.SIGN_STATUS.JOINING,
                        _b));
                }
            }
        });
    },
    doAuit: function (e) {
        var _this = this;
        var isOk = !!e.target.dataset.ok;
        var index = e.currentTarget.dataset.index;
        wx.showModal({
            title: this.data.auditing[index].name,
            content: (!isOk ? '拒绝' : '同意') + '该用户参加该活动?',
            success: function (_a) {
                var confirm = _a.confirm;
                return confirm && _this._doAuit(isOk, index);
            }
        });
    },
    _doAuit: function (isOk, index) {
        var _this = this;
        var _a = this.data, auditing = _a.auditing, refuse = _a.refuse, join = _a.join;
        http_1.request({
            url: '/api/activity/participation/audit',
            data: {
                flag: isOk,
                activityId: this.id,
                userId: auditing[index].userId
            }
        })
            .then(function () {
            wx.showToast({ title: '操作成功' });
            var item = auditing.splice(index, 1)[0];
            item.status = isOk ? status_1.SIGN_STATUS.AWAIT : status_1.SIGN_STATUS.REFUSE;
            (isOk ? join : refuse).push(item);
            _this.setData({ auditing: auditing, join: join, refuse: refuse });
        })
            .catch(console.log);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2lnbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInNpZ24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzREFBMEQ7QUFDMUQsK0NBQWlEO0FBU2pELElBQUksQ0FBQztJQUNELEVBQUUsRUFBRSxDQUFDO0lBQ0wsSUFBSSxFQUFFO1FBQ0YsUUFBUSxFQUFZLEVBQUU7UUFDdEIsSUFBSSxFQUFZLEVBQUU7UUFDbEIsTUFBTSxFQUFZLEVBQUU7UUFDcEIsTUFBTSxFQUFFO1lBQ0osUUFBUSxFQUFFLG9CQUFXLENBQUMsUUFBUTtZQUM5QixLQUFLLEVBQUUsb0JBQVcsQ0FBQyxLQUFLO1lBQ3hCLE9BQU8sRUFBRSxvQkFBVyxDQUFDLE9BQU87WUFDNUIsTUFBTSxFQUFFLG9CQUFXLENBQUMsTUFBTTtTQUM3QjtLQUNKO0lBQ0QsTUFBTSxZQUFDLEtBQW1CO1FBQTFCLGlCQXdCQztRQXZCRyxJQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsRUFBRSxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUN2QyxjQUFPLENBQVc7WUFDZCxHQUFHLEVBQUUsdUNBQXVDO1lBQzVDLElBQUksRUFBRSxFQUFFLFVBQVUsWUFBQSxFQUFFO1NBQ3ZCLENBQUM7YUFDRyxJQUFJLENBQUMsVUFBQyxFQUFZO2dCQUFYLGNBQVU7WUFDZCxJQUFNLFFBQVEsR0FBYSxFQUFFLENBQUM7WUFDOUIsSUFBTSxNQUFNLEdBQWEsRUFBRSxDQUFDO1lBQzVCLElBQU0sSUFBSSxHQUFhLEVBQUUsQ0FBQztZQUUxQixJQUFJLENBQUMsT0FBTyxDQUFDLFVBQUEsQ0FBQztnQkFDVixJQUFHLENBQUMsQ0FBQyxNQUFNLEtBQUssb0JBQVcsQ0FBQyxRQUFRLEVBQUU7b0JBQ2xDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQ3BCO3FCQUFNLElBQUcsQ0FBQyxDQUFDLE1BQU0sS0FBSyxvQkFBVyxDQUFDLE1BQU0sRUFBRTtvQkFDdkMsTUFBTSxD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VUFBQSxFQUFFLElBQUksTUFBQSxFQUFFLE1BQU0sUUFBQSxFQUFDLENBQUMsQ0FBQztRQUM1QyxDQUFDLENBQUM7YUFDRCxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3hCLENBQUM7Q0FDSixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTSUdOX1NUQVRVUyB9IGZyb20gJy4uLy4uLy4uLy4uL2NvbnN0YW50L3N0YXR1cyc7XHJcbmltcG9ydCB7IHJlcXVlc3QgfSBmcm9tICcuLi8uLi8uLi8uLi91dGlscy9odHRwJztcclxuXHJcbmludGVyZmFjZSBFbkluZm8ge1xyXG4gICAgbmFtZTogc3RyaW5nO1xyXG4gICAgcGhvbmU6IHN0cmluZztcclxuICAgIHVzZXJJZDogc3RyaW5nO1xyXG4gICAgc3RhdHVzOiBTSUdOX1NUQVRVUztcclxufVxyXG5cclxuUGFnZSh7XHJcbiAgICBpZDogMCxcclxuICAgIGRhdGE6IHtcclxuICAgICAgICBhdWRpdGluZzogPEVuSW5mb1tdPltdLCAvLyDlvoXlrqHmoLhcclxuICAgICAgICBqb2luOiA8RW5JbmZvW10+W10sIC8vIOWPguWKoOiAheWIl+ihqFxyXG4gICAgICAgIHJlZnVzZTogPEVuSW5mb1tdPltdLCAvLyDlt7Lmi5Lnu51cclxuICAgICAgICBTVEFUVVM6IHtcclxuICAgICAgICAgICAgQVVESVRJTkc6IFNJR05fU1RBVFVTLkFVRElUSU5HLFxyXG4gICAgICAgICAgICBBV0FJVDogU0lHTl9TVEFUVVMuQVdBSVQsXHJcbiAgICAgICAgICAgIEpPSU5JTkc6IFNJR05fU1RBVFVTLkpPSU5JTkcsXHJcbiAgICAgICAgICAgIFJFRlVTRTogU0lHTl9TVEFUVVMuUkVGVVNFXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIG9uTG9hZChxdWVyeToge2lkOiBzdHJpbmd9KSB7XHJcbiAgICAgICAgY29uc3QgYWN0aXZpdHlJZCA9IHRoaXMuaWQgPSArcXVlcnkuaWQ7XHJcbiAgICAgICAgcmVxdWVzdDxFbkluZm9bXT4oe1xyXG4gICAgICAgICAgICB1cmw6ICcvYXBpL2FjdGl2aXR5L3BhcnRpY2lwYXRpb24vYXVkaXRMaXN0JyxcclxuICAgICAgICAgICAgZGF0YTogeyBhY3Rpdml0eUlkIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgICAgICAudGhlbigoe2RhdGE6IGxpc3R9KSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhdWRpdGluZzogRW5JbmZvW10gPSBbXTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlZnVzZTogRW5JbmZvW10gPSBbXTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGpvaW46IEVuSW5mb1tdID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgbGlzdC5mb3JFYWNoKHYgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHYuc3RhdHVzID09PSBTSUdOX1NUQVRVUy5BVURJVElORykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhdWRpdGluZy5wdXNoKHYpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZih2LnN0YXR1cyA9PT0gU0lHTl9TVEFUVVMuUkVGVVNFKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZnVzZS5wdXNoKHYpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvaW4ucHVzaCh2KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldERhdGEhKHtyZWZ1c2UsIGF1ZGl0aW5nLCBqb2lufSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChjb25zb2xlLmxvZyk7XHJcbiAgICB9LFxyXG4gICAgZG9TaWduKHtjdXJyZW50VGFyZ2V0OiB7ZGF0YXNldDoge2luZGV4fX19OiBCYXNlRXZlbnQ8e2luZGV4OiBudW1iZXJ9Pikge1xyXG4gICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLmRhdGEuam9pbltpbmRleF07XHJcbiAgICAgICAgaWYoIWl0ZW0pIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgd3guc2hvd01vZGFsKHtcclxuICAgICAgICAgICAgdGl0bGU6IGl0ZW0ubmFtZSxcclxuICAgICAgICAgICAgY29udGVudDogJ+a0u+WKqOetvuWIsOehruiupCcsXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6ICh7Y29uZmlybX0pID0+IHtcclxuICAgICAgICAgICAgICAgIGlmKGNvbmZpcm0pIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldERhdGEhKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgW2Bqb2luWyR7aW5kZXh9XS5zdGF0dXNgXTogU0lHTl9TVEFUVVMuSk9JTklOR1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgZG9BdWl0KGU6IEJhc2VFdmVudDx7b2s/OiBzdHJpbmd9LCB7aW5kZXg6IG51bWJlcn0+KSB7XHJcbiAgICAgICAgY29uc3QgaXNPayA9ICEhZS50YXJnZXQuZGF0YXNldC5vaztcclxuICAgICAgICBjb25zdCBpbmRleCA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0LmluZGV4O1xyXG5cclxuICAgICAgICB3eC5zaG93TW9kYWwoe1xyXG4gICAgICAgICAgICB0aXRsZTogdGhpcy5kYXRhLmF1ZGl0aW5nW2luZGV4XS5uYW1lLFxyXG4gICAgICAgICAgICBjb250ZW50OiAoIWlzT2sgPyAn5ouS57udJyA6ICflkIzmhI8nKSArICfor6XnlKjmiLflj4LliqDor6XmtLvliqg/JyxcclxuICAgICAgICAgICAgc3VjY2VzczogKHtjb25maXJtfSkgPT4gY29uZmlybSAmJiB0aGlzLl9kb0F1aXQoaXNPaywgaW5kZXgpXHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgX2RvQXVpdChpc09rOiBib29sZWFuLCBpbmRleDogbnVtYmVyKSB7XHJcbiAgICAgICAgY29uc3Qge2F1ZGl0aW5nLCByZWZ1c2UsIGpvaW59ID0gdGhpcy5kYXRhO1xyXG5cclxuICAgICAgICByZXF1ZXN0KHtcclxuICAgICAgICAgICAgdXJsOiAnL2FwaS9hY3Rpdml0eS9wYXJ0aWNpcGF0aW9uL2F1ZGl0JyxcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgZmxhZzogaXNPayxcclxuICAgICAgICAgICAgICAgIGFjdGl2aXR5SWQ6IHRoaXMuaWQsXHJcbiAgICAgICAgICAgICAgICB1c2VySWQ6IGF1ZGl0aW5nW2luZGV4XS51c2VySWRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICB3eC5zaG93VG9hc3Qoe3RpdGxlOiAn5pON5L2c5oiQ5YqfJyB9KTtcclxuICAgICAgICAgICAgY29uc3QgaXRlbSA9IGF1ZGl0aW5nLnNwbGljZShpbmRleCwgMSlbMF07XHJcbiAgICAgICAgICAgIGl0ZW0uc3RhdHVzID0gaXNPayA/IFNJR05fU1RBVFVTLkFXQUlUIDogU0lHTl9TVEFUVVMuUkVGVVNFO1xyXG4gICAgICAgICAgICAoaXNPayAgPyBqb2luIDogcmVmdXNlKS5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgICB0aGlzLnNldERhdGEhKHthdWRpdGluZywgam9pbiwgcmVmdXNlfSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goY29uc29sZS5sb2cpO1xyXG4gICAgfVxyXG59KTtcclxuIl19