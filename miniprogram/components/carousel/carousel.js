"use strict";
Component({
    properties: {
        height: {
            type: String,
            value: '220rpx'
        },
        initial: {
            type: Number,
            value: 0
        },
        interval: {
            type: Number,
            value: 3000
        }
    },
    data: {
        items: [],
        index: 0,
        label: [],
        sx: 0,
        ex: 0
    },
    relations: {
        './item/item': {
            type: 'child',
            linked: function (target) {
                this.data.items.push(target);
            }
        }
    },
    ready: function () {
        var _a = this.data, initial = _a.initial, items = _a.items;
        this.setActiveItem(initial > items.length - 1 ? 0 : initial)._loop()
            .setData({ label: new Array(items.length).fill(1) });
    },
    detached: function () {
        this._clearTimer();
    },
    methods: {
        touchStart: function (_a) {
            var pageX = _a.touches[0].pageX;
            this.data.sx = pageX;
        },
        touchMove: function (_a) {
            var pageX = _a.touches[0].pageX;
            this.data.ex = pageX;
        },
        touchEnd: function () {
            var _a = this.data, sx = _a.sx, ex = _a.ex;
            if (sx < ex - 50) {
                this.prev();
            }
            else if (sx > ex + 50) {
                this.next();
            }
        },
        setActiveItem: function (nameOrIndex) {
            var items = this.data.items;
            if (items.length <= 1) {
                return this;
            }
            var index = this._getIndex(nameOrIndex);
            if (index == null) {
                return console.warn("\u672A\u627E\u5230" + (typeof nameOrIndex === 'number' ? '索引' : 'name') + "\u4E3A" + nameOrIndex + "\u7684\u8F6E\u64AD\u7EC4\u4EF6");
            }
            this.setData({ index: index });
            var offset = Math.floor(items.length / 2);
            var arr = items.slice(index).concat(items.slice(0, index));
            arr = arr.slice(-offset).concat(arr.slice(0, arr.length - offset));
            if (arr.length === 2) {
                arr.push(arr[0]);
            }
            arr.forEach(function (v, i) { return v.setData({ translate: (i - offset) * 100 + "%" }); });
            return this;
        },
        prev: function () {
            var _a = this.data, items = _a.items, index = _a.index;
            this._clearTimer().setActiveItem(index <= 0 ? items.length - 1 : index - 1)._loop();
            return this;
        },
        next: function () {
            var _a = this.data, items = _a.items, index = _a.index;
            this._clearTimer().setActiveItem(index >= items.length - 1 ? 0 : index + 1)._loop();
            return this;
        },
        _getIndex: function (nameOrIndex) {
            var items = this.data.items;
            if (typeof nameOrIndex === 'number') {
                if (nameOrIndex >= 0 && nameOrIndex <= items.length - 1) {
                    return nameOrIndex;
                }
            }
            else {
                var index = items.findIndex(function (v) { return v.data.name === nameOrIndex; });
                if (index > -1) {
                    return index;
                }
            }
            return void 0;
        },
        _loop: function () {
            var interval = this.data.interval;
            interval > 100 && (this.data.timer = setTimeout(this.next.bind(this), this.data.interval + 500));
            return this;
        },
        _clearTimer: function () {
            var timer = this.data.timer;
            if (timer) {
                clearTimeout(timer);
                this.data.timer = void 0;
            }
            return this;
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2Fyb3VzZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjYXJvdXNlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBMEJBLFNBQVMsQ0FBVztJQUNoQixVQUFVLEVBQUU7UUFDUixNQUFNLEVBQUU7WUFDSixJQUFJLEVBQUUsTUFBTTtZQUNaLEtBQUssRUFBRSxRQUFRO1NBQ2xCO1FBQ0QsT0FBTyxFQUFFO1lBQ0wsSUFBSSxFQUFFLE1BQU07WUFDWixLQUFLLEVBQUUsQ0FBQztTQUNYO1FBQ0QsUUFBUSxFQUFFO1lBQ04sSUFBSSxFQUFFLE1BQU07WUFDWixLQUFLLEVBQUUsSUFBSTtTQUNkO0tBQ0o7SUFDRCxJQUFJLEVBQUU7UUFDRixLQUFLLEVBQUUsRUFBRTtRQUNULEtBQUssRUFBRSxDQUFDO1FBQ1IsS0FBSyxFQUFFLEVBQUU7UUFDVCxFQUFFLEVBQUUsQ0FBQztRQUNMLEVBQUUsRUFBRSxDQUFDO0tBQ1I7SUFDRCxTQUFTLEVBQUU7UUFDUCxhQUFhLEVBQUU7WUFDWCxJQUFJLEVBQUUsT0FBTztZQUNiLE1BQU0sWUFBQyxNQUFtQjtnQkFDdEIsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2pDLENBQUM7U0FDSjtLQUNKO0lBQ0QsS0FBSztRQUNLLElBQUEsY0FBNEIsRUFBM0Isb0JBQU8sRUFBRSxnQkFBa0IsQ0FBQztRQUNuQyxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFLLEVBQUU7YUFDL0QsT0FBTyxDQUFDLEVBQUMsS0FBSyxFQUFFLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO0lBQzNELENBQUM7SUFDRCxRQUFRO1FBQ0os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Q0FBQztZQUM5QixJQUFHLEtBQUssRUFBRTtnQkFDTixZQUFZLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ3BCLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQyxDQUFDO2FBQzVCO1lBRUQsT0FBTyxJQUFJLENBQUM7UUFDaEIsQ0FBQztLQUNKO0NBQ0osQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIOi9ruaSrVxyXG4gKi9cclxuXHJcbmludGVyZmFjZSBDYXJvdXNlbCBleHRlbmRzIFd4Q29tcG9uZW50IHtcclxuICAgIGRhdGE6IHtcclxuICAgICAgICBsYWJlbDogQXJyYXk8MT47IC8vIOWIm+W7uuagh+iusOeahOaVsOe7hFxyXG4gICAgICAgIGluZGV4OiBudW1iZXI7IC8vIOW9k+WJjeaYvuekuue7hOS7tue0ouW8lVxyXG5cclxuICAgICAgICBpdGVtczogV3hDb21wb25lbnRbXTsgLy8g5rua5Yqo57uE5Lu2XHJcbiAgICAgICAgdGltZXI/OiBudW1iZXI7IC8vIOWumuaXtuWZqGlkXHJcbiAgICAgICAgc3g6IG51bWJlcjsgLy8gdG91Y2hTdGFydCDnmoR45Z2Q5qCHXHJcbiAgICAgICAgZXg6IG51bWJlcjsgLy8gdG91Y2hFbmQg5pe255qEeOWdkOagh1xyXG5cclxuICAgICAgICBpbnRlcnZhbDogbnVtYmVyOyAvLyDlrprml7blmajosIPnlKjpl7TpmpRcclxuICAgICAgICBpbml0aWFsOiBudW1iZXI7IC8vIOWIneWni+aYvuekuueahOe7hOS7tue0ouW8lVxyXG4gICAgfTtcclxuICAgIHNldEFjdGl2ZUl0ZW0obmFtZU9ySW5kZXg6IHN0cmluZyB8IG51bWJlcik6IENhcm91c2VsO1xyXG4gICAgcHJldigpOiBDYXJvdXNlbDtcclxuICAgIG5leHQoKTogQ2Fyb3VzZWw7XHJcblxyXG4gICAgX2dldEluZGV4KG5hbWVPckluZGV4OiBzdHJpbmcgfCBudW1iZXIpOiBudW1iZXIgfCB2b2lkO1xyXG4gICAgX2xvb3AoKTogQ2Fyb3VzZWw7XHJcbiAgICBfY2xlYXJUaW1lcigpOiBDYXJvdXNlbDtcclxufVxyXG5cclxuQ29tcG9uZW50PENhcm91c2VsPih7XHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgaGVpZ2h0OiB7XHJcbiAgICAgICAgICAgIHR5cGU6IFN0cmluZyxcclxuICAgICAgICAgICAgdmFsdWU6ICcyMjBycHgnXHJcbiAgICAgICAgfSxcclxuICAgICAgICBpbml0aWFsOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IE51bWJlcixcclxuICAgICAgICAgICAgdmFsdWU6IDBcclxuICAgICAgICB9LFxyXG4gICAgICAgIGludGVydmFsOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IE51bWJlcixcclxuICAgICAgICAgICAgdmFsdWU6IDMwMDBcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgZGF0YToge1xyXG4gICAgICAgIGl0ZW1zOiBbXSxcclxuICAgICAgICBpbmRleDogMCxcclxuICAgICAgICBsYWJlbDogW10sXHJcbiAgICAgICAgc3g6IDAsXHJcbiAgICAgICAgZXg6IDBcclxuICAgIH0sXHJcbiAgICByZWxhdGlvbnM6IHtcclxuICAgICAgICAnLi9pdGVtL2l0ZW0nOiB7XHJcbiAgICAgICAgICAgIHR5cGU6ICdjaGlsZCcsXHJcbiAgICAgICAgICAgIGxpbmtlZCh0YXJnZXQ6IFd4Q29tcG9uZW50KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEuaXRlbXMucHVzaCh0YXJnZXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHJlYWR5KHRoaXM6IENhcm91c2VsKSB7XHJcbiAgICAgICAgY29uc3Qge2luaXRpYWwsIGl0ZW1zfSA9IHRoaXMuZGF0YTtcclxuICAgICAgICB0aGlzLnNldEFjdGl2ZUl0ZW0oaW5pdGlhbCA+IGl0ZW1zLmxlbmd0aCAtIDEgPyAwIDogaW5pdGlhbCkuX2xvb3AoKVxyXG4gICAgICAgICAgICAuc2V0RGF0YSh7bGFiZWw6IG5ldyBBcnJheShpdGVtcy5sZW5ndGgpLmZpbGwoMSl9KTtcclxuICAgIH0sXHJcbiAgICBkZXRhY2hlZCh0aGlzOiBDYXJvdXNlbCkge1xyXG4gICAgICAgIHRoaXMuX2NsZWFyVGltZXIoKTtcclxuICAgIH0sXHJcbiAgICBtZXRob2RzOiB7XHJcbiAgICAgICAgdG91Y2hTdGFydCh7dG91Y2hlczogW3twYWdlWH1dfTogV3hUb3VjaEV2ZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YS5zeCA9IHBhZ2VYO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdG91Y2hNb3ZlKHt0b3VjaGVzOiBbe3BhZ2VYfV19OiBXeFRvdWNoRXZlbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhLmV4ID0gcGFnZVg7XHJcbiAgICAgICAgfSxcclxuICAgICAgICB0b3VjaEVuZCgpIHtcclxuICAgICAgICAgICAgY29uc3Qge3N4LCBleH0gPSB0aGlzLmRhdGE7XHJcbiAgICAgICAgICAgIGlmKHN4IDwgZXggLSA1MCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wcmV2KCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZihzeCA+IGV4ICsgNTApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubmV4dCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXRBY3RpdmVJdGVtKG5hbWVPckluZGV4OiBzdHJpbmcgfCBudW1iZXIpIHtcclxuICAgICAgICAgICAgY29uc3QgaXRlbXMgPSB0aGlzLmRhdGEuaXRlbXM7XHJcblxyXG4gICAgICAgICAgICAvLyDlpITnkIblsI/kuo7kuKTpobnnmoTmg4XlhrVcclxuICAgICAgICAgICAgaWYoaXRlbXMubGVuZ3RoIDw9IDEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuX2dldEluZGV4KG5hbWVPckluZGV4KTtcclxuICAgICAgICAgICAgaWYoaW5kZXggPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybihcclxuICAgICAgICAgICAgICAgICAgICBg5pyq5om+5YiwJHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZW9mIG5hbWVPckluZGV4ID09PSAnbnVtYmVyJyA/ICfntKLlvJUnIDogJ25hbWUnXHJcbiAgICAgICAgICAgICAgICAgICAgfeS4uiR7bmFtZU9ySW5kZXh955qE6L2u5pKt57uE5Lu2YFxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5zZXREYXRhKHtpbmRleH0pO1xyXG4gICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBNYXRoLmZsb29yKGl0ZW1zLmxlbmd0aCAvIDIpO1xyXG4gICAgICAgICAgICBsZXQgYXJyID0gWy4uLml0ZW1zLnNsaWNlKGluZGV4KSwgLi4uaXRlbXMuc2xpY2UoMCwgaW5kZXgpXTtcclxuICAgICAgICAgICAgYXJyID0gWy4uLmFyci5zbGljZSgtb2Zmc2V0KSwgLi4uYXJyLnNsaWNlKDAsIGFyci5sZW5ndGggLSBvZmZzZXQpXTtcclxuXHJcbiAgICAgICAgICAgIC8vIOWkhOeQhuWPquacieS4pOmhueeahOaDheWGtVxyXG4gICAgICAgICAgICBpZihhcnIubGVuZ3RoID09PSAyKSB7XHJcbiAgICAgICAgICAgICAgICBhcnIucHVzaChhcnJbMF0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBhcnIuZm9yRWFjaCgodiwgaSkgPT4gdi5zZXREYXRhKHt0cmFuc2xhdGU6IGAkeyhpIC0gb2Zmc2V0KSAqIDEwMH0lYH0pICk7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9LFxyXG4gICAgICAgIHByZXYoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHtpdGVtcywgaW5kZXh9ID0gdGhpcy5kYXRhO1xyXG4gICAgICAgICAgICB0aGlzLl9jbGVhclRpbWVyKCkuc2V0QWN0aXZlSXRlbShpbmRleCA8PSAwID8gaXRlbXMubGVuZ3RoIC0gMSA6IGluZGV4IC0gMSkuX2xvb3AoKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbmV4dCgpIHtcclxuICAgICAgICAgICAgY29uc3Qge2l0ZW1zLCBpbmRleH0gPSB0aGlzLmRhdGE7XHJcbiAgICAgICAgICAgIHRoaXMuX2NsZWFyVGltZXIoKS5zZXRBY3RpdmVJdGVtKGluZGV4ID49IGl0ZW1zLmxlbmd0aCAtIDEgPyAwIDogaW5kZXggKyAxKS5fbG9vcCgpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBfZ2V0SW5kZXgobmFtZU9ySW5kZXg6IHN0cmluZyB8IG51bWJlcikge1xyXG4gICAgICAgICAgICBjb25zdCBpdGVtcyA9IHRoaXMuZGF0YS5pdGVtcztcclxuICAgICAgICAgICAgaWYodHlwZW9mIG5hbWVPckluZGV4ID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICAgICAgaWYobmFtZU9ySW5kZXggPj0gMCAmJiBuYW1lT3JJbmRleCA8PSBpdGVtcy5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hbWVPckluZGV4O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBpdGVtcy5maW5kSW5kZXgodiA9PiB2LmRhdGEubmFtZSA9PT0gbmFtZU9ySW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgaWYoaW5kZXggPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbmRleDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHZvaWQgMDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIF9sb29wKCkge1xyXG4gICAgICAgICAgICBjb25zdCBpbnRlcnZhbCA9IHRoaXMuZGF0YS5pbnRlcnZhbDtcclxuICAgICAgICAgICAgaW50ZXJ2YWwgPiAxMDAgJiYgKHRoaXMuZGF0YS50aW1lciA9IHNldFRpbWVvdXQodGhpcy5uZXh0LmJpbmQodGhpcyksIHRoaXMuZGF0YS5pbnRlcnZhbCArIDUwMCkpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBfY2xlYXJUaW1lcigpIHtcclxuICAgICAgICAgICAgY29uc3QgdGltZXIgPSB0aGlzLmRhdGEudGltZXI7XHJcbiAgICAgICAgICAgIGlmKHRpbWVyKSB7XHJcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhLnRpbWVyID0gdm9pZCAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pO1xyXG4iXX0=