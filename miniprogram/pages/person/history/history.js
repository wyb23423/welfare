"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var http_1 = require("../../../utils/http");
var util_1 = require("../../../utils/util");
var index_1 = require("../../../constant/index");
Page({
    data: {
        history: [],
        type: '',
        tabType: 0,
        another: []
    },
    onLoad: function (query) {
        this.data.type = query.type;
        var type = "_" + query.type;
        this[type] && this[type]();
        var titles = {
            await: '待参加',
            auditing: '待审核',
            complete: '已参加',
            evaluate: '待评价',
            initiate: '我的发起',
            collection: '我的收藏'
        };
        wx.setNavigationBarTitle({
            title: titles[query.type]
        });
    },
    delete: function (e) {
        var _this = this;
        var index = +e.target.dataset.index;
        var history = this.data.history;
        wx.showModal({
            content: this.data.type === 'collection' ? '取消收藏？' : '删除该活动？',
            success: function (res) {
                if (res.confirm) {
                    if (_this.data.type === 'collection') {
                        return _this._cancelCollect(index);
                    }
                    http_1.request({
                        url: '/api/activity',
                        method: 'DELETE',
                        data: { activityId: history[index].id }
                    })
                        .then(function () {
                        wx.showToast({ title: '删除成功' });
                        history.splice(index, 1);
                        _this.setData({ history: history });
                    })
                        .catch(console.log);
                }
            }
        });
    },
    openEnList: function (e) {
        var index = +e.target.dataset.index;
        var enList = this.selectComponent('#en-list');
        enList.show(this.data.history[index].id);
    },
    ok: function (e) {
        var _this = this;
        wx.showModal({
            content: '该活动已完成?',
            success: function (res) {
                if (res.confirm) {
                    var index_2 = +e.target.dataset.index;
                    var history_1 = _this.data.history;
                    http_1.request({ url: '/api/activity/achieve/' + history_1[index_2].id })
                        .then(function () {
                        wx.showToast({ title: '操作成功' });
                        history_1[index_2].status = index_1.ActiveStatus.complete;
                        _this.setData({ history: history_1 });
                    })
                        .catch(console.log);
                }
            }
        });
    },
    none: function () {
    },
    switch: function (e) {
        this.data.tabType = +e.target.dataset.type;
        var another = this.data.another;
        this.data.another = this.data.history;
        if (another.length) {
            this.data.history = another;
            return this.setData(this.data);
        }
        this._collection();
    },
    _cancelCollect: function (index) {
        var _this = this;
        var history = this.data.history;
        http_1.request({
            url: '/api/like',
            method: 'DELETE',
            data: {
                targetId: history[index].id,
                type: this.data.tabType
            }
        })
            .then(function () {
            wx.showToast({ title: '取消搜藏成功' });
            history.splice(index, 1);
            _this.setData({ history: history });
        })
            .catch(console.log);
    },
    _await: function () {
        this._request('/api/activity/participation/list/await');
    },
    _auditing: function () {
        this._request('/api/activity/participation/list/auditing');
    },
    _complete: function () {
        this._request('/api/activity/participation/list/complete');
    },
    _evaluate: function () {
        this._request('/api/activity/participation/list/evaluate');
    },
    _initiate: function () {
        this._request('/api/activity/my');
    },
    _collection: function () {
        var _this = this;
        var tabType = this.data.tabType;
        http_1.request({
            url: '/api/like',
            data: { type: tabType }
        })
            .then(function (_a) {
            var data = _a.data;
            return _this.setData({
                history: data.map(util_1.parseData),
                type: _this.data.type,
                tabType: tabType
            });
        })
            .catch(console.log);
    },
    _request: function (url) {
        var _this = this;
        http_1.request({ url: url })
            .then(function (_a) {
            var data = _a.data;
            return _this.setData({ type: _this.data.type, history: data.map(util_1.parseData) });
        })
            .catch(console.log);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGlzdG9yeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImhpc3RvcnkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw0Q0FBOEM7QUFDOUMsNENBQWdEO0FBRWhELGlEQUF1RDtBQUl2RCxJQUFJLENBQUM7SUFDRCxJQUFJLEVBQUU7UUFDRixPQUFPLEVBQUUsRUFBaUM7UUFDMUMsSUFBSSxFQUFFLEVBQUU7UUFDUixPQUFPLEVBQUUsQ0FBQztRQUNWLE9BQU8sRUFBK0IsRUFBRTtLQUMzQztJQUNELE1BQU0sWUFBQyxLQUFpQjtRQUNwQixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDO1FBRTVCLElBQU0sSUFBSSxHQUFnQixNQUFJLEtBQUssQ0FBQyxJQUFNLENBQUM7UUFDM0MsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1FBRTNCLElBQU0sTUFBTSxHQUFRO1lBQ2hCLEtBQUssRUFBRSxLQUFLO1lBQ1osUUFBUSxFQUFFLEtBQUs7WUFDZixRQUFRLEVBQUUsS0FBSztZQUNmLFFBQVEsRUFBRSxLQUFLO1lBQ2YsUUFBUSxFQUFFLE1BQU07WUFDaEIsVUFBVSxFQUFFLE1BQU07U0FDckIsQ0FBQztRQUNGLEVBQUUsQ0FBQyxxQkFBcUIsQ0FBQztZQUNyQixLQUFLLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7U0FDNUIsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUNELE1BQU0sWUFBQyxDQUFlO1FBQXRCLGlCQTBCQztRQXpCRyxJQUFNLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQztRQUN0QyxJQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQztRQUVsQyxFQUFFLENBQUMsU0FBUyxDQUFDO1lBQ1QsT0FBTyxFQUFFLElBQUksQ0FBQyxJQUFJ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QUM7SUFDRCxTQUFTO1FBQ0wsSUFBSSxDQUFDLFFBQVEsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFDRCxXQUFXO1FBQVgsaUJBWUM7UUFYRyxJQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQztRQUNsQyxjQUFPLENBQTJCO1lBQzlCLEdBQUcsRUFBRSxXQUFXO1lBQ2hCLElBQUksRUFBRSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUU7U0FDMUIsQ0FBQzthQUNHLElBQUksQ0FBQyxVQUFDLEVBQVE7Z0JBQU4sY0FBSTtZQUFPLE9BQUEsS0FBSSxDQUFDLE9BQVEsQ0FBQztnQkFDOUIsT0FBTyxFQUFVLElBQUssQ0FBQyxHQUFHLENBQUMsZ0JBQVMsQ0FBQztnQkFDckMsSUFBSSxFQUFFLEtBQUksQ0FBQyxJQUFJLENBQUMsSUFBSTtnQkFDcEIsT0FBTyxTQUFBO2FBQ1YsQ0FBQztRQUprQixDQUlsQixDQUFDO2FBQ0YsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBQ0QsUUFBUSxZQUFDLEdBQVc7UUFBcEIsaUJBSUM7UUFIRyxjQUFPLENBQVksRUFBRSxHQUFHLEtBQUEsRUFBRSxDQUFDO2FBQ3RCLElBQUksQ0FBQyxVQUFDLEVBQVE7Z0JBQU4sY0FBSTtZQUFPLE9BQUEsS0FBSSxDQUFDLE9BQVEsQ0FBQyxFQUFFLElBQUksRUFBRSxLQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxnQkFBUyxDQUFDLEVBQUUsQ0FBQztRQUFyRSxDQUFxRSxDQUFDO2FBQ3pGLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDNUIsQ0FBQztDQUNKLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHJlcXVlc3QgfSBmcm9tICcuLi8uLi8uLi91dGlscy9odHRwJztcclxuaW1wb3J0IHsgcGFyc2VEYXRhIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvdXRpbCc7XHJcbmltcG9ydCB7IEVuTGlzdCB9IGZyb20gJy4uLy4uLy4uL2NvbXBvbmVudHMvZW5saXN0L2VubGlzdCc7XHJcbmltcG9ydCB7IEFjdGl2ZVN0YXR1cyB9IGZyb20gJy4uLy4uLy4uL2NvbnN0YW50L2luZGV4JztcclxuXHJcbnR5cGUgSGlzdG9yeVR5cGUgPSAnX2F3YWl0JyB8ICdfYXVkaXRpbmcnIHwgJ19jb21wbGV0ZSc7XHJcblxyXG5QYWdlKHtcclxuICAgIGRhdGE6IHtcclxuICAgICAgICBoaXN0b3J5OiBbXSBhcyBBcnJheTxJQWN0aXZlIHwgSUNvbW1vZGl0eT4sXHJcbiAgICAgICAgdHlwZTogJycsXHJcbiAgICAgICAgdGFiVHlwZTogMCxcclxuICAgICAgICBhbm90aGVyOiA8QXJyYXk8SUFjdGl2ZSB8IElDb21tb2RpdHk+PltdXHJcbiAgICB9LFxyXG4gICAgb25Mb2FkKHF1ZXJ5OiBJQW55T2JqZWN0KSB7XHJcbiAgICAgICAgdGhpcy5kYXRhLnR5cGUgPSBxdWVyeS50eXBlO1xyXG5cclxuICAgICAgICBjb25zdCB0eXBlID0gPEhpc3RvcnlUeXBlPmBfJHtxdWVyeS50eXBlfWA7XHJcbiAgICAgICAgdGhpc1t0eXBlXSAmJiB0aGlzW3R5cGVdKCk7XHJcblxyXG4gICAgICAgIGNvbnN0IHRpdGxlczogYW55ID0ge1xyXG4gICAgICAgICAgICBhd2FpdDogJ+W+heWPguWKoCcsXHJcbiAgICAgICAgICAgIGF1ZGl0aW5nOiAn5b6F5a6h5qC4JyxcclxuICAgICAgICAgICAgY29tcGxldGU6ICflt7Llj4LliqAnLFxyXG4gICAgICAgICAgICBldmFsdWF0ZTogJ+W+heivhOS7tycsXHJcbiAgICAgICAgICAgIGluaXRpYXRlOiAn5oiR55qE5Y+R6LW3JyxcclxuICAgICAgICAgICAgY29sbGVjdGlvbjogJ+aIkeeahOaUtuiXjydcclxuICAgICAgICB9O1xyXG4gICAgICAgIHd4LnNldE5hdmlnYXRpb25CYXJUaXRsZSh7XHJcbiAgICAgICAgICAgIHRpdGxlOiB0aXRsZXNbcXVlcnkudHlwZV1cclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBkZWxldGUoZTogV3hUb3VjaEV2ZW50KSB7XHJcbiAgICAgICAgY29uc3QgaW5kZXggPSArZS50YXJnZXQuZGF0YXNldC5pbmRleDtcclxuICAgICAgICBjb25zdCBoaXN0b3J5ID0gdGhpcy5kYXRhLmhpc3Rvcnk7XHJcblxyXG4gICAgICAgIHd4LnNob3dNb2RhbCh7XHJcbiAgICAgICAgICAgIGNvbnRlbnQ6IHRoaXMuZGF0YS50eXBlID09PSAnY29sbGVjdGlvbicgPyAn5Y+W5raI5pS26JeP77yfJyA6ICfliKDpmaTor6XmtLvliqjvvJ8nLFxyXG4gICAgICAgICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzLmNvbmZpcm0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kYXRhLnR5cGUgPT09ICdjb2xsZWN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY2FuY2VsQ29sbGVjdChpbmRleCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXF1ZXN0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAnL2FwaS9hY3Rpdml0eScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0RFTEVURScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHsgYWN0aXZpdHlJZDogaGlzdG9yeVtpbmRleF0uaWQgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHd4LnNob3dUb2FzdCh7IHRpdGxlOiAn5Yig6Zmk5oiQ5YqfJyB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpc3Rvcnkuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RGF0YSEoeyBoaXN0b3J5IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goY29uc29sZS5sb2cpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9LFxyXG4gICAgb3BlbkVuTGlzdChlOiBXeFRvdWNoRXZlbnQpIHtcclxuICAgICAgICBjb25zdCBpbmRleCA9ICtlLnRhcmdldC5kYXRhc2V0LmluZGV4O1xyXG4gICAgICAgIGNvbnN0IGVuTGlzdCA9IDxFbkxpc3Q+dGhpcy5zZWxlY3RDb21wb25lbnQhKCcjZW4tbGlzdCcpO1xyXG5cclxuICAgICAgICBlbkxpc3Quc2hvdyh0aGlzLmRhdGEuaGlzdG9yeVtpbmRleF0uaWQpO1xyXG4gICAgfSxcclxuICAgIG9rKGU6IFd4VG91Y2hFdmVudCkge1xyXG4gICAgICAgIHd4LnNob3dNb2RhbCh7XHJcbiAgICAgICAgICAgIGNvbnRlbnQ6ICfor6XmtLvliqjlt7LlrozmiJA/JyxcclxuICAgICAgICAgICAgc3VjY2VzczogKHJlcykgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlcy5jb25maXJtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSArZS50YXJnZXQuZGF0YXNldC5pbmRleDtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBoaXN0b3J5ID0gPElBY3RpdmVbXT50aGlzLmRhdGEuaGlzdG9yeTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdCh7IHVybDogJy9hcGkvYWN0aXZpdHkvYWNoaWV2ZS8nICsgaGlzdG9yeVtpbmRleF0uaWQgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd3guc2hvd1RvYXN0KHt0aXRsZTogJ+aTjeS9nOaIkOWKnyd9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhpc3RvcnlbaW5kZXhdLnN0YXR1cyA9IEFjdGl2ZVN0YXR1cy5jb21wbGV0ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0RGF0YSEoe2hpc3Rvcnl9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGNvbnNvbGUubG9nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuICAgIG5vbmUoKSB7XHJcbiAgICAgICAgLy9cclxuICAgIH0sXHJcbiAgICBzd2l0Y2goZTogV3hUb3VjaEV2ZW50KSB7XHJcbiAgICAgICAgdGhpcy5kYXRhLnRhYlR5cGUgPSArZS50YXJnZXQuZGF0YXNldC50eXBlO1xyXG4gICAgICAgIGNvbnN0IGFub3RoZXIgPSB0aGlzLmRhdGEuYW5vdGhlcjtcclxuICAgICAgICB0aGlzLmRhdGEuYW5vdGhlciA9IHRoaXMuZGF0YS5oaXN0b3J5O1xyXG5cclxuICAgICAgICBpZiAoYW5vdGhlci5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhLmhpc3RvcnkgPSBhbm90aGVyO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZXREYXRhISh0aGlzLmRhdGEpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fY29sbGVjdGlvbigpO1xyXG4gICAgfSxcclxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICAgIF9jYW5jZWxDb2xsZWN0KGluZGV4OiBudW1iZXIpIHtcclxuICAgICAgICBjb25zdCBoaXN0b3J5ID0gdGhpcy5kYXRhLmhpc3Rvcnk7XHJcblxyXG4gICAgICAgIHJlcXVlc3Qoe1xyXG4gICAgICAgICAgICB1cmw6ICcvYXBpL2xpa2UnLFxyXG4gICAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXRJZDogaGlzdG9yeVtpbmRleF0uaWQsXHJcbiAgICAgICAgICAgICAgICB0eXBlOiB0aGlzLmRhdGEudGFiVHlwZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgd3guc2hvd1RvYXN0KHsgdGl0bGU6ICflj5bmtojmkJzol4/miJDlip8nIH0pO1xyXG4gICAgICAgICAgICAgICAgaGlzdG9yeS5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXREYXRhISh7IGhpc3RvcnkgfSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChjb25zb2xlLmxvZyk7XHJcbiAgICB9LFxyXG4gICAgX2F3YWl0KCkge1xyXG4gICAgICAgIHRoaXMuX3JlcXVlc3QoJy9hcGkvYWN0aXZpdHkvcGFydGljaXBhdGlvbi9saXN0L2F3YWl0Jyk7XHJcbiAgICB9LFxyXG4gICAgX2F1ZGl0aW5nKCkge1xyXG4gICAgICAgIHRoaXMuX3JlcXVlc3QoJy9hcGkvYWN0aXZpdHkvcGFydGljaXBhdGlvbi9saXN0L2F1ZGl0aW5nJyk7XHJcbiAgICB9LFxyXG4gICAgX2NvbXBsZXRlKCkge1xyXG4gICAgICAgIHRoaXMuX3JlcXVlc3QoJy9hcGkvYWN0aXZpdHkvcGFydGljaXBhdGlvbi9saXN0L2NvbXBsZXRlJyk7XHJcbiAgICB9LFxyXG4gICAgX2V2YWx1YXRlKCkge1xyXG4gICAgICAgIHRoaXMuX3JlcXVlc3QoJy9hcGkvYWN0aXZpdHkvcGFydGljaXBhdGlvbi9saXN0L2V2YWx1YXRlJyk7XHJcbiAgICB9LFxyXG4gICAgX2luaXRpYXRlKCkge1xyXG4gICAgICAgIHRoaXMuX3JlcXVlc3QoJy9hcGkvYWN0aXZpdHkvbXknKTtcclxuICAgIH0sXHJcbiAgICBfY29sbGVjdGlvbigpIHtcclxuICAgICAgICBjb25zdCB0YWJUeXBlID0gdGhpcy5kYXRhLnRhYlR5cGU7XHJcbiAgICAgICAgcmVxdWVzdDxJQ29tbW9kaXR5W10gfCBJQWN0aXZlW10+KHtcclxuICAgICAgICAgICAgdXJsOiAnL2FwaS9saWtlJyxcclxuICAgICAgICAgICAgZGF0YTogeyB0eXBlOiB0YWJUeXBlIH1cclxuICAgICAgICB9KVxyXG4gICAgICAgICAgICAudGhlbigoeyBkYXRhIH0pID0+IHRoaXMuc2V0RGF0YSEoe1xyXG4gICAgICAgICAgICAgICAgaGlzdG9yeTogKDxhbnlbXT5kYXRhKS5tYXAocGFyc2VEYXRhKSxcclxuICAgICAgICAgICAgICAgIHR5cGU6IHRoaXMuZGF0YS50eXBlLFxyXG4gICAgICAgICAgICAgICAgdGFiVHlwZVxyXG4gICAgICAgICAgICB9KSlcclxuICAgICAgICAgICAgLmNhdGNoKGNvbnNvbGUubG9nKTtcclxuICAgIH0sXHJcbiAgICBfcmVxdWVzdCh1cmw6IHN0cmluZykge1xyXG4gICAgICAgIHJlcXVlc3Q8SUFjdGl2ZVtdPih7IHVybCB9KVxyXG4gICAgICAgICAgICAudGhlbigoeyBkYXRhIH0pID0+IHRoaXMuc2V0RGF0YSEoeyB0eXBlOiB0aGlzLmRhdGEudHlwZSwgaGlzdG9yeTogZGF0YS5tYXAocGFyc2VEYXRhKSB9KSlcclxuICAgICAgICAgICAgLmNhdGNoKGNvbnNvbGUubG9nKTtcclxuICAgIH1cclxufSk7XHJcbiJdfQ==