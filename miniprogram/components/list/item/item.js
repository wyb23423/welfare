"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var util_1 = require("../../../utils/util");
var http_1 = require("../../../utils/http");
function parseTime(start, end) {
    var _a = util_1.resolveTime(start), sy = _a.year, sm = _a.month, sd = _a.day;
    var _b = util_1.resolveTime(end), ey = _b.year, em = _b.month, ed = _b.day;
    if (sy === ey) {
        if (sm === em && sd === ed) {
            return sm + "/" + sd;
        }
        return sm + "/" + sd + " - " + em + "/" + ed;
    }
    else {
        return sy + "/" + sm + "/" + sd + " - " + ey + "/" + em + "/" + sd;
    }
}
Component({
    options: {
        multipleSlots: true
    },
    properties: {
        info: {
            type: Object,
            value: {}
        },
        isGoods: {
            type: Number,
            value: 0
        },
        hasBtn: {
            type: Boolean,
            value: false
        }
    },
    data: {
        time: '',
        btn: ''
    },
    attached: function () {
        var _a = this.data, _b = _a.info, size = _b.size, sign = _b.sign, origination = _b.origination, finish = _b.finish, hasBtn = _a.hasBtn, isGoods = _a.isGoods;
        var obj = { time: parseTime(+origination, +finish), btn: '' };
        if (hasBtn) {
            var text = parseBtnText(sign, size);
            var word = isGoods ? '兑换' : '报名';
            obj.btn = text ? word + text : '立即' + word;
        }
        this.setData(obj);
    },
    methods: {
        clickBtn: function () {
            var _a = this.data, _b = _a.info, size = _b.size, sign = _b.sign, origination = _b.origination, id = _b.id, isGoods = _a.isGoods;
            if (size - sign <= 0 || Date.now() > origination) {
                return;
            }
            if (isGoods) {
                exchange(createEvent({ id: id }));
            }
            else {
                wx.navigateTo({ url: "/pages/sign/sign?id=" + id });
            }
        }
    }
});
function parseBtnText(sign, size) {
    var reset = size - sign;
    if (reset <= 0) {
        return '已满';
    }
    else if (reset <= Math.max(2, Math.round(size / 10))) {
        return '仅剩' + reset + '名';
    }
    return '';
}
exports.parseBtnText = parseBtnText;
function exchange(e) {
    var id = e.target.dataset.id;
    http_1.request({ url: '/api/commodity/participation/deal/' + id })
        .then(function () { return wx.navigateTo({ url: '/pages/success/success?title=兑换成功&content=请尽快到发布者处获取商品' }); })
        .catch(console.log);
}
exports.exchange = exchange;
function createEvent(dataset) {
    return {
        type: 'simulation',
        detail: {},
        target: { id: 'id', dataset: dataset },
        currentTarget: { id: 'id', dataset: dataset },
        timeStamp: Date.now(),
        mark: {}
    };
}
exports.createEvent = createEvent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaXRlbS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIml0ZW0udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw0Q0FBa0Q7QUFDbEQsNENBQThDO0FBWTlDLFNBQVMsU0FBUyxDQUFDLEtBQWEsRUFBRSxHQUFXO0lBQ25DLElBQUEsOEJBQW1ELEVBQWxELFlBQVEsRUFBRSxhQUFTLEVBQUUsV0FBNkIsQ0FBQztJQUNwRCxJQUFBLDRCQUFpRCxFQUFoRCxZQUFRLEVBQUUsYUFBUyxFQUFFLFdBQTJCLENBQUM7SUFFeEQsSUFBRyxFQUFFLEtBQUssRUFBRSxFQUFFO1FBQ1YsSUFBRyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLEVBQUU7WUFDdkIsT0FBVSxFQUFFLFNBQUksRUFBSSxDQUFDO1NBQ3hCO1FBRUQsT0FBVSxFQUFFLFNBQUksRUFBRSxXQUFNLEVBQUUsU0FBSSxFQUFJLENBQUM7S0FDdEM7U0FBTTtRQUNILE9BQVUsRUFBRSxTQUFJLEVBQUUsU0FBSSxFQUFFLFdBQU0sRUFBRSxTQUFJLEVBQUUsU0FBSSxFQUFJLENBQUM7S0FDbEQ7QUFDTCxDQUFDO0FBRUQsU0FBUyxDQUFXO0lBQ2hCLE9BQU8sRUFBRTtRQUNMLGFBQWEsRUFBRSxJQUFJO0tBQ3RCO0lBQ0QsVUFBVSxFQUFFO1FBQ1IsSUFBSSxFQUFFO1lBQ0YsSUFBSSxFQUFFLE1BQU07WUFDWixLQUFLLEVBQUUsRUFBRTtTQUNaO1FBQ0QsT0FBTyxFQUFFO1lBQ0wsSUFBSSxFQUFFLE1BQU07WUFDWixLQUFLLEVBQUUsQ0FBQztTQUNYO1FBRUQsTUFBTSxFQUFFO1lBQ0osSUFBSSxFQUFFLE9BQU87WUFDYixLQUFLLEVBQUUsS0FBSztTQUNmO0tBQ0o7SUFDRCxJQUFJLEVBQUU7UUFDRixJQUFJLEVBQUUsRUFBRTtRQUNSLEdBQUcsRUFBRSxFQUFFO0tBQ1Y7SUFDRCxRQUFRO1FBQ0UsSUFBQSxjQUFzRSxFQUFyRSxZQUF1QyxFQUFoQyxjQUFJLEVBQUUs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dmVUaW1lIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvdXRpbCc7XHJcbmltcG9ydCB7IHJlcXVlc3QgfSBmcm9tICcuLi8uLi8uLi91dGlscy9odHRwJztcclxuXHJcbmludGVyZmFjZSBMaXN0SXRlbSBleHRlbmRzIFd4Q29tcG9uZW50IHtcclxuICAgIGRhdGE6IHtcclxuICAgICAgICBpbmZvOiBJQWN0aXZlIHwgSUNvbW1vZGl0eSxcclxuICAgICAgICBoYXNCdG46IGJvb2xlYW47XHJcbiAgICAgICAgaXNHb29kczogYm9vbGVhbjtcclxuICAgICAgICB0aW1lOiBzdHJpbmc7XHJcbiAgICAgICAgYnRuOiBzdHJpbmdcclxuICAgIH07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHBhcnNlVGltZShzdGFydDogbnVtYmVyLCBlbmQ6IG51bWJlcikge1xyXG4gICAgY29uc3Qge3llYXI6IHN5LCBtb250aDogc20sIGRheTogc2R9ID0gcmVzb2x2ZVRpbWUoc3RhcnQpO1xyXG4gICAgY29uc3Qge3llYXI6IGV5LCBtb250aDogZW0sIGRheTogZWR9ID0gcmVzb2x2ZVRpbWUoZW5kKTtcclxuXHJcbiAgICBpZihzeSA9PT0gZXkpIHtcclxuICAgICAgICBpZihzbSA9PT0gZW0gJiYgc2QgPT09IGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBgJHtzbX0vJHtzZH1gO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGAke3NtfS8ke3NkfSAtICR7ZW19LyR7ZWR9YDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIGAke3N5fS8ke3NtfS8ke3NkfSAtICR7ZXl9LyR7ZW19LyR7c2R9YDtcclxuICAgIH1cclxufVxyXG5cclxuQ29tcG9uZW50PExpc3RJdGVtPih7XHJcbiAgICBvcHRpb25zOiB7XHJcbiAgICAgICAgbXVsdGlwbGVTbG90czogdHJ1ZVxyXG4gICAgfSxcclxuICAgIHByb3BlcnRpZXM6IHtcclxuICAgICAgICBpbmZvOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IE9iamVjdCxcclxuICAgICAgICAgICAgdmFsdWU6IHt9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBpc0dvb2RzOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IE51bWJlcixcclxuICAgICAgICAgICAgdmFsdWU6IDBcclxuICAgICAgICB9LFxyXG4gICAgICAgIC8vIOaYr+WQpuiHquW4puaMiemSrlxyXG4gICAgICAgIGhhc0J0bjoge1xyXG4gICAgICAgICAgICB0eXBlOiBCb29sZWFuLFxyXG4gICAgICAgICAgICB2YWx1ZTogZmFsc2VcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgZGF0YToge1xyXG4gICAgICAgIHRpbWU6ICcnLFxyXG4gICAgICAgIGJ0bjogJydcclxuICAgIH0sXHJcbiAgICBhdHRhY2hlZCh0aGlzOiBMaXN0SXRlbSkge1xyXG4gICAgICAgIGNvbnN0IHtpbmZvOiB7c2l6ZSwgc2lnbiwgb3JpZ2luYXRpb24sIGZpbmlzaH0sIGhhc0J0biwgaXNHb29kc30gPSB0aGlzLmRhdGE7XHJcblxyXG4gICAgICAgIGNvbnN0IG9iaiA9IHt0aW1lOiBwYXJzZVRpbWUoK29yaWdpbmF0aW9uLCArZmluaXNoKSwgYnRuOiAnJ307XHJcbiAgICAgICAgaWYoaGFzQnRuKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRleHQgPSBwYXJzZUJ0blRleHQoc2lnbiwgc2l6ZSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHdvcmQgPSBpc0dvb2RzID8gJ+WFkeaNoicgOiAn5oql5ZCNJztcclxuICAgICAgICAgICAgb2JqLmJ0biA9IHRleHQgPyB3b3JkICsgdGV4dCA6ICfnq4vljbMnICsgd29yZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zZXREYXRhKG9iaik7XHJcbiAgICB9LFxyXG4gICAgbWV0aG9kczoge1xyXG4gICAgICAgIGNsaWNrQnRuKCkge1xyXG4gICAgICAgICAgICBjb25zdCB7aW5mbzoge3NpemUsIHNpZ24sIG9yaWdpbmF0aW9uLCBpZH0sIGlzR29vZHN9ID0gdGhpcy5kYXRhO1xyXG4gICAgICAgICAgICBpZihzaXplIC0gc2lnbiA8PSAwIHx8IERhdGUubm93KCkgPiBvcmlnaW5hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZihpc0dvb2RzKSB7XHJcbiAgICAgICAgICAgICAgICBleGNoYW5nZShjcmVhdGVFdmVudCh7aWR9KSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB3eC5uYXZpZ2F0ZVRvKHt1cmw6IGAvcGFnZXMvc2lnbi9zaWduP2lkPSR7aWR9YH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KTtcclxuXHJcbi8qKlxyXG4gKiDmoLnmja7lj6/miqXlkI0v5YWR5o2i5Ymp5L2Z5Lq65pWw5pi+56S65LiN5ZCM55qE5oyJ6ZKuXHJcbiAqIEBwYXJhbSBzaWduIOW3suaKpeWQjS/lhZHmjaLkurrmlbBcclxuICogQHBhcmFtIHNpemUg5oC75pWwXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VCdG5UZXh0KHNpZ246IG51bWJlciwgc2l6ZTogbnVtYmVyKSB7XHJcbiAgICBjb25zdCByZXNldCA9IHNpemUgLSBzaWduO1xyXG4gICAgaWYocmVzZXQgPD0gMCkge1xyXG4gICAgICAgIHJldHVybiAn5bey5ruhJztcclxuICAgIH0gZWxzZSBpZihyZXNldCA8PSBNYXRoLm1heCgyLCBNYXRoLnJvdW5kKHNpemUgLyAxMCkpKSB7XHJcbiAgICAgICAgcmV0dXJuICfku4XliaknICsgcmVzZXQgKyAn5ZCNJztcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gJyc7XHJcbn1cclxuXHJcbi8qXHJcbiog5YWR5o2i5ZWG5ZOBXHJcbiovXHJcbmV4cG9ydCBmdW5jdGlvbiBleGNoYW5nZSh0aGlzOiBhbnksIGU6IEJhc2VFdmVudDx7aWQ6IG51bWJlcn0+KSB7XHJcbiAgICBjb25zdCBpZCA9IGUudGFyZ2V0LmRhdGFzZXQuaWQ7XHJcbiAgICByZXF1ZXN0KHsgdXJsOiAnL2FwaS9jb21tb2RpdHkvcGFydGljaXBhdGlvbi9kZWFsLycgKyBpZCB9KVxyXG4gICAgICAgIC50aGVuKCgpID0+IHd4Lm5hdmlnYXRlVG8oe3VybDogJy9wYWdlcy9zdWNjZXNzL3N1Y2Nlc3M/dGl0bGU95YWR5o2i5oiQ5YqfJmNvbnRlbnQ96K+35bC95b+r5Yiw5Y+R5biD6ICF5aSE6I635Y+W5ZWG5ZOBJ30pKVxyXG4gICAgICAgIC5jYXRjaChjb25zb2xlLmxvZyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVFdmVudDxUIGV4dGVuZHMgb2JqZWN0PihkYXRhc2V0OiBUKTogQmFzZUV2ZW50PFQ+IHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgdHlwZTogJ3NpbXVsYXRpb24nLFxyXG4gICAgICAgIGRldGFpbDoge30sXHJcbiAgICAgICAgdGFyZ2V0OiB7aWQ6ICdpZCcsIGRhdGFzZXR9LFxyXG4gICAgICAgIGN1cnJlbnRUYXJnZXQ6IHtpZDogJ2lkJywgZGF0YXNldH0sXHJcbiAgICAgICAgdGltZVN0YW1wOiBEYXRlLm5vdygpLFxyXG4gICAgICAgIG1hcms6IHt9XHJcbiAgICB9O1xyXG59XHJcbiJdfQ==