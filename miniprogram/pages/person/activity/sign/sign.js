"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var status_1 = require("../../../../constant/status");
var http_1 = require("../../../../utils/http");
Page({
    id: 0,
    data: {
        auditing: [],
        handled: [],
        STATUS: {
            AUDITING: status_1.SIGN_STATUS.AUDITING,
            AWAIT: status_1.SIGN_STATUS.AWAIT,
            REFUSE: status_1.SIGN_STATUS.REFUSE
        }
    },
    onLoad: function (query) {
        var _this = this;
        var activityId = this.id = +query.id;
        http_1.request({
            url: '/api/activity/participation/auditList',
            data: { activityId: activityId }
        })
            .then(function (_a) {
            var list = _a.data;
            var auditing = [];
            var handled = [];
            list.forEach(function (v) {
                if (v.status === status_1.SIGN_STATUS.AUDITING) {
                    auditing.push(v);
                }
                else {
                    handled.push(v);
                }
            });
            _this.setData({ handled: handled, auditing: auditing });
        })
            .catch(console.log);
    },
    doAuit: function (e) {
        var _this = this;
        var isOk = !!e.target.dataset.ok;
        var index = e.currentTarget.dataset.index;
        wx.showModal({
            title: this.data.auditing[index].name,
            content: (!isOk ? '拒绝' : '同意') + '该用户参加该活动?',
            success: function (_a) {
                var confirm = _a.confirm;
                return confirm && _this._doAuit(isOk, index);
            }
        });
    },
    _doAuit: function (isOk, index) {
        var _this = this;
        var _a = this.data, auditing = _a.auditing, handled = _a.handled;
        http_1.request({
            url: '/api/activity/participation/audit',
            data: {
                flag: isOk,
                activityId: this.id,
                userId: auditing[index].userId
            }
        })
            .then(function () {
            var _a;
            wx.showToast({ title: '操作成功' });
            var item = auditing.splice(index, 1)[0];
            item.status = isOk ? status_1.SIGN_STATUS.AWAIT : status_1.SIGN_STATUS.REFUSE;
            _this.setData((_a = { auditing: auditing }, _a["handled[" + handled.length + "]"] = item, _a));
        })
            .catch(console.log);
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2lnbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInNpZ24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzREFBMEQ7QUFDMUQsK0NBQWlEO0FBU2pELElBQUksQ0FBQztJQUNELEVBQUUsRUFBRSxDQUFDO0lBQ0wsSUFBSSxFQUFFO1FBQ0YsUUFBUSxFQUFZLEVBQUU7UUFDdEIsT0FBTyxFQUFZLEVBQUU7UUFDckIsTUFBTSxFQUFFO1lBQ0osUUFBUSxFQUFFLG9CQUFXLENBQUMsUUFBUTtZQUM5QixLQUFLLEVBQUUsb0JBQVcsQ0FBQyxLQUFLO1lBQ3hCLE1BQU0sRUFBRSxvQkFBVyxDQUFDLE1BQU07U0FDN0I7S0FDSjtJQUNELE1BQU0sWUFBQyxLQUFtQjtRQUExQixpQkFxQkM7UUFwQkcsSUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDdkMsY0FBTyxDQUFXO1lBQ2QsR0FBRyxFQUFFLHVDQUF1QztZQUM1QyxJQUFJLEVBQUUsRUFBRSxVQUFVLFlBQUEsRUFBRTtTQUN2QixDQUFDO2FBQ0csSUFBSSxDQUFDLFVBQUMsRUFBWTtnQkFBWCxjQUFVO1lBQ2QsSUFBTSxRQUFRLEdBQWEsRUFBRSxDQUFDO1lBQzlCLElBQU0sT0FBTyxHQUFhLEVBQUUsQ0FBQztZQUU3QixJQUFJLENBQUMsT0FBTyxDQUFDLFVBQUEsQ0FBQztnQkFDVixJQUFHLENBQUMsQ0FBQyxNQUFNLEtBQUssb0JBQVcsQ0FBQyxRQUFRLEVBQUU7b0JBQ2xDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQ3BCO3FCQUFNO29CQUNILE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQ25CO1lBQ0wsQ0FBQyxDQUFDLENBQUM7WUFFSCxLQUFJLENBQUMsT0FBUSxDQUFDLEVBQUMsT0FBTyxTQUFBLEVBQUUsUUFBUSxVQUFBLEVBQUMsQ0FBQyxDQUFDO1FBQ3ZDLENBQUMsQ0FBQzthQUNELEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDNUIsQ0FBQztJQUNELE1BQU0sWUFBQyxDQUE0QztRQUFuRCxpQkFTQztRQVJHLElBQU0sSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7UUFDbkMsSUFBTSxLQUFLLEdBQUcsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDO1FBRTVDLEVBQUUsQ0FBQyxTQUFTLENBQUM7WUFDVCxLQUFLLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSTtZQUNyQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxXQUFXO1lBQzVDLE9BQU8sRUFBRSxVQUFDLEVBQVM7b0JBQVIsb0JBQU87Z0JBQU0sT0FBQSxPQUFPLElBQUksS0FBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDO1lBQXBDLENBQW9DO1NBQy9ELENBQUMsQ0FBQztJQUNQLENBQUM7SUFDRCxPQUFPLFlBQUMsSUFBYSxFQUFFLEtBQWE7UUFBcEMsaUJBa0JDO1FBakJTLElBQUEsY0FBK0IsRUFBOUIsc0JBQVEsRUFBRSxvQkFBb0IsQ0FBQztRQUV0QyxjQUFPLENBQUM7WUFDSixHQUFHLEVBQUUsbUNBQW1DO1lBQ3hDLElBQUksRUFBRTtnQkFDRixJQUFJLEVBQUUsSUFBSTtnQkFDVixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUU7Z0JBQ25CLE1BQU0sRUFBRSxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTTthQUNqQztTQUNKLENBQUM7YUFDRCxJQUFJLENBQUM7O1lBQ0YsRUFBRSxDQUFDLFNBQVMsQ0FBQyxFQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBQy9CLElBQU0sSUFBSSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzFDLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxvQkFBVyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsb0JBQVcsQ0FBQyxNQUFNLENBQUM7WUFDNUQsS0FBSSxDQUFDLE9BQVEsU0FBRSxRQUFRLFVBQUEsSUFBRSxHQUFDLGFBQVcsT0FBTyxDQUFDLE1BQU0sTUFBRyxJQUFHLElBQUksTUFBRSxDQUFDO1FBQ3BFLENBQUMsQ0FBQzthQUNELEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDeEIsQ0FBQztDQUNKLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNJR05fU1RBVFVTIH0gZnJvbSAnLi4vLi4vLi4vLi4vY29uc3RhbnQvc3RhdHVzJztcclxuaW1wb3J0IHsgcmVxdWVzdCB9IGZyb20gJy4uLy4uLy4uLy4uL3V0aWxzL2h0dHAnO1xyXG5cclxuaW50ZXJmYWNlIEVuSW5mbyB7XHJcbiAgICBuYW1lOiBzdHJpbmc7XHJcbiAgICBwaG9uZTogc3RyaW5nO1xyXG4gICAgdXNlcklkOiBzdHJpbmc7XHJcbiAgICBzdGF0dXM6IFNJR05fU1RBVFVTO1xyXG59XHJcblxyXG5QYWdlKHtcclxuICAgIGlkOiAwLFxyXG4gICAgZGF0YToge1xyXG4gICAgICAgIGF1ZGl0aW5nOiA8RW5JbmZvW10+W10sIC8vIOW+heWuoeaguFxyXG4gICAgICAgIGhhbmRsZWQ6IDxFbkluZm9bXT5bXSwgLy8g5bey5aSE55CGXHJcbiAgICAgICAgU1RBVFVTOiB7XHJcbiAgICAgICAgICAgIEFVRElUSU5HOiBTSUdOX1NUQVRVUy5BVURJVElORyxcclxuICAgICAgICAgICAgQVdBSVQ6IFNJR05fU1RBVFVTLkFXQUlULFxyXG4gICAgICAgICAgICBSRUZVU0U6IFNJR05fU1RBVFVTLlJFRlVTRVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBvbkxvYWQocXVlcnk6IHtpZDogc3RyaW5nfSkge1xyXG4gICAgICAgIGNvbnN0IGFjdGl2aXR5SWQgPSB0aGlzLmlkID0gK3F1ZXJ5LmlkO1xyXG4gICAgICAgIHJlcXVlc3Q8RW5JbmZvW10+KHtcclxuICAgICAgICAgICAgdXJsOiAnL2FwaS9hY3Rpdml0eS9wYXJ0aWNpcGF0aW9uL2F1ZGl0TGlzdCcsXHJcbiAgICAgICAgICAgIGRhdGE6IHsgYWN0aXZpdHlJZCB9XHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRoZW4oKHtkYXRhOiBsaXN0fSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYXVkaXRpbmc6IEVuSW5mb1tdID0gW107XHJcbiAgICAgICAgICAgICAgICBjb25zdCBoYW5kbGVkOiBFbkluZm9bXSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgICAgIGxpc3QuZm9yRWFjaCh2ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZih2LnN0YXR1cyA9PT0gU0lHTl9TVEFUVVMuQVVESVRJTkcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXVkaXRpbmcucHVzaCh2KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVkLnB1c2godik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXREYXRhISh7aGFuZGxlZCwgYXVkaXRpbmd9KTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKGNvbnNvbGUubG9nKTtcclxuICAgIH0sXHJcbiAgICBkb0F1aXQoZTogQmFzZUV2ZW50PHtvaz86IHN0cmluZ30sIHtpbmRleDogbnVtYmVyfT4pIHtcclxuICAgICAgICBjb25zdCBpc09rID0gISFlLnRhcmdldC5kYXRhc2V0Lm9rO1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5kZXg7XHJcblxyXG4gICAgICAgIHd4LnNob3dNb2RhbCh7XHJcbiAgICAgICAgICAgIHRpdGxlOiB0aGlzLmRhdGEuYXVkaXRpbmdbaW5kZXhdLm5hbWUsXHJcbiAgICAgICAgICAgIGNvbnRlbnQ6ICghaXNPayA/ICfmi5Lnu50nIDogJ+WQjOaEjycpICsgJ+ivpeeUqOaIt+WPguWKoOivpea0u+WKqD8nLFxyXG4gICAgICAgICAgICBzdWNjZXNzOiAoe2NvbmZpcm19KSA9PiBjb25maXJtICYmIHRoaXMuX2RvQXVpdChpc09rLCBpbmRleClcclxuICAgICAgICB9KTtcclxuICAgIH0sXHJcbiAgICBfZG9BdWl0KGlzT2s6IGJvb2xlYW4sIGluZGV4OiBudW1iZXIpIHtcclxuICAgICAgICBjb25zdCB7YXVkaXRpbmcsIGhhbmRsZWR9ID0gdGhpcy5kYXRhO1xyXG5cclxuICAgICAgICByZXF1ZXN0KHtcclxuICAgICAgICAgICAgdXJsOiAnL2FwaS9hY3Rpdml0eS9wYXJ0aWNpcGF0aW9uL2F1ZGl0JyxcclxuICAgICAgICAgICAgZGF0YToge1xyXG4gICAgICAgICAgICAgICAgZmxhZzogaXNPayxcclxuICAgICAgICAgICAgICAgIGFjdGl2aXR5SWQ6IHRoaXMuaWQsXHJcbiAgICAgICAgICAgICAgICB1c2VySWQ6IGF1ZGl0aW5nW2luZGV4XS51c2VySWRcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICB3eC5zaG93VG9hc3Qoe3RpdGxlOiAn5pON5L2c5oiQ5YqfJyB9KTtcclxuICAgICAgICAgICAgY29uc3QgaXRlbSA9IGF1ZGl0aW5nLnNwbGljZShpbmRleCwgMSlbMF07XHJcbiAgICAgICAgICAgIGl0ZW0uc3RhdHVzID0gaXNPayA/IFNJR05fU1RBVFVTLkFXQUlUIDogU0lHTl9TVEFUVVMuUkVGVVNFO1xyXG4gICAgICAgICAgICB0aGlzLnNldERhdGEhKHthdWRpdGluZywgW2BoYW5kbGVkWyR7aGFuZGxlZC5sZW5ndGh9XWBdOiBpdGVtfSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goY29uc29sZS5sb2cpO1xyXG4gICAgfVxyXG59KTtcclxuIl19