"use strict";
Component({
    properties: {
        height: {
            type: String,
            value: '40vw'
        },
        initial: {
            type: Number,
            value: 0
        },
        interval: {
            type: Number,
            value: 3000
        }
    },
    data: {
        items: [],
        index: 0,
        label: [],
        sx: 0,
        ex: 0,
        isMoving: false
    },
    relations: {
        './item/item': {
            type: 'child',
            linked: function (target) {
                this.data.items.push(target);
            }
        }
    },
    ready: function () {
        var _this = this;
        setTimeout(function () {
            var _a = _this.data, initial = _a.initial, items = _a.items;
            _this.setActiveItem(initial > items.length - 1 ? 0 : initial)._loop()
                .setData({ label: new Array(items.length).fill(1) });
        }, 100);
    },
    detached: function () {
        this._clearTimer();
    },
    methods: {
        touchStart: function (_a) {
            var pageX = _a.touches[0].pageX;
            this.data.sx = pageX;
        },
        touchMove: function (_a) {
            var pageX = _a.touches[0].pageX;
            this.data.ex = pageX;
        },
        touchEnd: function () {
            var _a = this.data, sx = _a.sx, ex = _a.ex, length = _a.items.length, isMoving = _a.isMoving;
            if (length <= 2 || isMoving) {
                return;
            }
            if (sx < ex - 50) {
                this.prev();
            }
            else if (sx > ex + 50) {
                this.next();
            }
        },
        setActiveItem: function (nameOrIndex) {
            var _this = this;
            var items = this.data.items;
            if (items.length <= 1) {
                return this;
            }
            var index = this._getIndex(nameOrIndex);
            if (index == null) {
                return console.warn("\u672A\u627E\u5230" + (typeof nameOrIndex === 'number' ? '索引' : 'name') + "\u4E3A" + nameOrIndex + "\u7684\u8F6E\u64AD\u7EC4\u4EF6");
            }
            this.setData({ index: index });
            var offset = Math.floor(items.length / 2);
            var arr = items.slice(index).concat(items.slice(0, index));
            arr = arr.slice(-offset).concat(arr.slice(0, arr.length - offset));
            setTimeout(function () {
                _this.data.isMoving = false;
                arr.length <= 2 && arr[0].setData({ translate: '100%' });
            }, 500);
            arr.forEach(function (v, i) { return v.setData({ translate: (i - offset) * 100 + "%" }); });
            this.data.isMoving = true;
            return this;
        },
        prev: function () {
            var _a = this.data, items = _a.items, index = _a.index;
            this._clearTimer().setActiveItem(index <= 0 ? items.length - 1 : index - 1)._loop();
            return this;
        },
        next: function () {
            var _a = this.data, items = _a.items, index = _a.index;
            this._clearTimer().setActiveItem(index >= items.length - 1 ? 0 : index + 1)._loop();
            return this;
        },
        _getIndex: function (nameOrIndex) {
            var items = this.data.items;
            if (typeof nameOrIndex === 'number') {
                if (nameOrIndex >= 0 && nameOrIndex <= items.length - 1) {
                    return nameOrIndex;
                }
            }
            else {
                var index = items.findIndex(function (v) { return v.data.name === nameOrIndex; });
                if (index > -1) {
                    return index;
                }
            }
            return void 0;
        },
        _loop: function () {
            var interval = this.data.interval;
            interval > 100 && (this.data.timer = setTimeout(this.next.bind(this), this.data.interval + 500));
            return this;
        },
        _clearTimer: function () {
            var timer = this.data.timer;
            if (timer) {
                clearTimeout(timer);
                this.data.timer = void 0;
            }
            return this;
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2Fyb3VzZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjYXJvdXNlbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBMkJBLFNBQVMsQ0FBVztJQUNoQixVQUFVLEVBQUU7UUFDUixNQUFNLEVBQUU7WUFDSixJQUFJLEVBQUUsTUFBTTtZQUNaLEtBQUssRUFBRSxNQUFNO1NBQ2hCO1FBQ0QsT0FBTyxFQUFFO1lBQ0wsSUFBSSxFQUFFLE1BQU07WUFDWixLQUFLLEVBQUUsQ0FBQztTQUNYO1FBQ0QsUUFBUSxFQUFFO1lBQ04sSUFBSSxFQUFFLE1BQU07WUFDWixLQUFLLEVBQUUsSUFBSTtTQUNkO0tBQ0o7SUFDRCxJQUFJLEVBQUU7UUFDRixLQUFLLEVBQUUsRUFBRTtRQUNULEtBQUssRUFBRSxDQUFDO1FBQ1IsS0FBSyxFQUFFLEVBQUU7UUFDVCxFQUFFLEVBQUUsQ0FBQztRQUNMLEVBQUUsRUFBRSxDQUFDO1FBQ0wsUUFBUSxFQUFFLEtBQUs7S0FDbEI7SUFDRCxTQUFTLEVBQUU7UUFDUCxhQUFhLEVBQUU7WUFDWCxJQUFJLEVBQUUsT0FBTztZQUNiLE1BQU0sWUFBQyxNQUFtQjtnQkFDdEIsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2pDLENBQUM7U0FDSjtLQUNKO0lBQ0QsS0FBSztRQUFMLGlCQU1DO1FBTEcsVUFBVSxDQUFDO1lBQ0QsSUFBQSxlQUE0QixFQUEzQixvQkFBTyxFQUFFLGdCQUFrQixDQUFDO1lBQ25DLEtBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssRUFBRTtpQkFDbkUsT0FBTyxDQUFDLEVBQUMsS0FBSyxFQUFFLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FB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UUFDRCxLQUFLO1lBQ0QsSUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUM7WUFDcEMsUUFBUSxHQUFHLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBRWpHLE9BQU8sSUFBSSxDQUFDO1FBQ2hCLENBQUM7UUFDRCxXQUFXO1lBQ1AsSUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7WUFDOUIsSUFBRyxLQUFLLEVBQUU7Z0JBQ04sWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUNwQixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsQ0FBQzthQUM1QjtZQUVELE9BQU8sSUFBSSxDQUFDO1FBQ2hCLENBQUM7S0FDSjtDQUNKLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiDova7mkq1cclxuICovXHJcblxyXG5pbnRlcmZhY2UgQ2Fyb3VzZWwgZXh0ZW5kcyBXeENvbXBvbmVudCB7XHJcbiAgICBkYXRhOiB7XHJcbiAgICAgICAgbGFiZWw6IEFycmF5PDE+OyAvLyDliJvlu7rmoIforrDnmoTmlbDnu4RcclxuICAgICAgICBpbmRleDogbnVtYmVyOyAvLyDlvZPliY3mmL7npLrnu4Tku7bntKLlvJVcclxuXHJcbiAgICAgICAgaXRlbXM6IFd4Q29tcG9uZW50W107IC8vIOa7muWKqOe7hOS7tlxyXG4gICAgICAgIHRpbWVyPzogbnVtYmVyOyAvLyDlrprml7blmahpZFxyXG4gICAgICAgIHN4OiBudW1iZXI7IC8vIHRvdWNoU3RhcnQg55qEeOWdkOagh1xyXG4gICAgICAgIGV4OiBudW1iZXI7IC8vIHRvdWNoRW5kIOaXtueahHjlnZDmoIdcclxuICAgICAgICBpc01vdmluZzogYm9vbGVhbjtcclxuXHJcbiAgICAgICAgaW50ZXJ2YWw6IG51bWJlcjsgLy8g5a6a5pe25Zmo6LCD55So6Ze06ZqUXHJcbiAgICAgICAgaW5pdGlhbDogbnVtYmVyOyAvLyDliJ3lp4vmmL7npLrnmoTnu4Tku7bntKLlvJVcclxuICAgIH07XHJcbiAgICBzZXRBY3RpdmVJdGVtKG5hbWVPckluZGV4OiBzdHJpbmcgfCBudW1iZXIpOiBDYXJvdXNlbDtcclxuICAgIHByZXYoKTogQ2Fyb3VzZWw7XHJcbiAgICBuZXh0KCk6IENhcm91c2VsO1xyXG5cclxuICAgIF9nZXRJbmRleChuYW1lT3JJbmRleDogc3RyaW5nIHwgbnVtYmVyKTogbnVtYmVyIHwgdm9pZDtcclxuICAgIF9sb29wKCk6IENhcm91c2VsO1xyXG4gICAgX2NsZWFyVGltZXIoKTogQ2Fyb3VzZWw7XHJcbn1cclxuXHJcbkNvbXBvbmVudDxDYXJvdXNlbD4oe1xyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIGhlaWdodDoge1xyXG4gICAgICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIHZhbHVlOiAnNDB2dydcclxuICAgICAgICB9LFxyXG4gICAgICAgIGluaXRpYWw6IHtcclxuICAgICAgICAgICAgdHlwZTogTnVtYmVyLFxyXG4gICAgICAgICAgICB2YWx1ZTogMFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaW50ZXJ2YWw6IHtcclxuICAgICAgICAgICAgdHlwZTogTnVtYmVyLFxyXG4gICAgICAgICAgICB2YWx1ZTogMzAwMFxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBkYXRhOiB7XHJcbiAgICAgICAgaXRlbXM6IFtdLFxyXG4gICAgICAgIGluZGV4OiAwLFxyXG4gICAgICAgIGxhYmVsOiBbXSxcclxuICAgICAgICBzeDogMCxcclxuICAgICAgICBleDogMCxcclxuICAgICAgICBpc01vdmluZzogZmFsc2VcclxuICAgIH0sXHJcbiAgICByZWxhdGlvbnM6IHtcclxuICAgICAgICAnLi9pdGVtL2l0ZW0nOiB7XHJcbiAgICAgICAgICAgIHR5cGU6ICdjaGlsZCcsXHJcbiAgICAgICAgICAgIGxpbmtlZCh0YXJnZXQ6IFd4Q29tcG9uZW50KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEuaXRlbXMucHVzaCh0YXJnZXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIHJlYWR5KHRoaXM6IENhcm91c2VsKSB7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHtpbml0aWFsLCBpdGVtc30gPSB0aGlzLmRhdGE7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlSXRlbShpbml0aWFsID4gaXRlbXMubGVuZ3RoIC0gMSA/IDAgOiBpbml0aWFsKS5fbG9vcCgpXHJcbiAgICAgICAgICAgIC5zZXREYXRhKHtsYWJlbDogbmV3IEFycmF5KGl0ZW1zLmxlbmd0aCkuZmlsbCgxKX0pO1xyXG4gICAgICAgIH0sIDEwMCk7XHJcbiAgICB9LFxyXG4gICAgZGV0YWNoZWQodGhpczogQ2Fyb3VzZWwpIHtcclxuICAgICAgICB0aGlzLl9jbGVhclRpbWVyKCk7XHJcbiAgICB9LFxyXG4gICAgbWV0aG9kczoge1xyXG4gICAgICAgIHRvdWNoU3RhcnQoe3RvdWNoZXM6IFt7cGFnZVh9XX06IFd4VG91Y2hFdmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmRhdGEuc3ggPSBwYWdlWDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHRvdWNoTW92ZSh7dG91Y2hlczogW3twYWdlWH1dfTogV3hUb3VjaEV2ZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YS5leCA9IHBhZ2VYO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdG91Y2hFbmQoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHtzeCwgZXgsIGl0ZW1zOiB7bGVuZ3RofSwgaXNNb3Zpbmd9ID0gdGhpcy5kYXRhO1xyXG5cclxuICAgICAgICAgICAgLy8g6aG555uu5pWw5LiN5aSn5LqOMiwg5omL5Yqo5rua5Yqo5rKh5LuA5LmI5aSq5aSn5b+F6KaB77yM5LiN5aSE55CGXHJcbiAgICAgICAgICAgIGlmKGxlbmd0aCA8PSAyIHx8IGlzTW92aW5nKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmKHN4IDwgZXggLSA1MCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wcmV2KCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZihzeCA+IGV4ICsgNTApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubmV4dCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXRBY3RpdmVJdGVtKG5hbWVPckluZGV4OiBzdHJpbmcgfCBudW1iZXIpIHtcclxuICAgICAgICAgICAgY29uc3QgaXRlbXMgPSB0aGlzLmRhdGEuaXRlbXM7XHJcblxyXG4gICAgICAgICAgICAvLyDlpITnkIblsI/kuo7kuKTpobnnmoTmg4XlhrVcclxuICAgICAgICAgICAgaWYoaXRlbXMubGVuZ3RoIDw9IDEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMuX2dldEluZGV4KG5hbWVPckluZGV4KTtcclxuICAgICAgICAgICAgaWYoaW5kZXggPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUud2FybihcclxuICAgICAgICAgICAgICAgICAgICBg5pyq5om+5YiwJHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZW9mIG5hbWVPckluZGV4ID09PSAnbnVtYmVyJyA/ICfntKLlvJUnIDogJ25hbWUnXHJcbiAgICAgICAgICAgICAgICAgICAgfeS4uiR7bmFtZU9ySW5kZXh955qE6L2u5pKt57uE5Lu2YFxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5zZXREYXRhKHtpbmRleH0pO1xyXG4gICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBNYXRoLmZsb29yKGl0ZW1zLmxlbmd0aCAvIDIpO1xyXG4gICAgICAgICAgICBsZXQgYXJyID0gWy4uLml0ZW1zLnNsaWNlKGluZGV4KSwgLi4uaXRlbXMuc2xpY2UoMCwgaW5kZXgpXTtcclxuICAgICAgICAgICAgYXJyID0gWy4uLmFyci5zbGljZSgtb2Zmc2V0KSwgLi4uYXJyLnNsaWNlKDAsIGFyci5sZW5ndGggLSBvZmZzZXQpXTtcclxuXHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhLmlzTW92aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBhcnIubGVuZ3RoIDw9IDIgJiYgYXJyWzBdLnNldERhdGEoe3RyYW5zbGF0ZTogJzEwMCUnfSk7XHJcbiAgICAgICAgICAgIH0sIDUwMCk7XHJcblxyXG4gICAgICAgICAgICBhcnIuZm9yRWFjaCgodiwgaSkgPT4gdi5zZXREYXRhKHt0cmFuc2xhdGU6IGAkeyhpIC0gb2Zmc2V0KSAqIDEwMH0lYH0pICk7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YS5pc01vdmluZyA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9LFxyXG4gICAgICAgIHByZXYoKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHtpdGVtcywgaW5kZXh9ID0gdGhpcy5kYXRhO1xyXG4gICAgICAgICAgICB0aGlzLl9jbGVhclRpbWVyKCkuc2V0QWN0aXZlSXRlbShpbmRleCA8PSAwID8gaXRlbXMubGVuZ3RoIC0gMSA6IGluZGV4IC0gMSkuX2xvb3AoKTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbmV4dCgpIHtcclxuICAgICAgICAgICAgY29uc3Qge2l0ZW1zLCBpbmRleH0gPSB0aGlzLmRhdGE7XHJcbiAgICAgICAgICAgIHRoaXMuX2NsZWFyVGltZXIoKS5zZXRBY3RpdmVJdGVtKGluZGV4ID49IGl0ZW1zLmxlbmd0aCAtIDEgPyAwIDogaW5kZXggKyAxKS5fbG9vcCgpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBfZ2V0SW5kZXgobmFtZU9ySW5kZXg6IHN0cmluZyB8IG51bWJlcikge1xyXG4gICAgICAgICAgICBjb25zdCBpdGVtcyA9IHRoaXMuZGF0YS5pdGVtcztcclxuICAgICAgICAgICAgaWYodHlwZW9mIG5hbWVPckluZGV4ID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICAgICAgaWYobmFtZU9ySW5kZXggPj0gMCAmJiBuYW1lT3JJbmRleCA8PSBpdGVtcy5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5hbWVPckluZGV4O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBpdGVtcy5maW5kSW5kZXgodiA9PiB2LmRhdGEubmFtZSA9PT0gbmFtZU9ySW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgaWYoaW5kZXggPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbmRleDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHZvaWQgMDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIF9sb29wKCkge1xyXG4gICAgICAgICAgICBjb25zdCBpbnRlcnZhbCA9IHRoaXMuZGF0YS5pbnRlcnZhbDtcclxuICAgICAgICAgICAgaW50ZXJ2YWwgPiAxMDAgJiYgKHRoaXMuZGF0YS50aW1lciA9IHNldFRpbWVvdXQodGhpcy5uZXh0LmJpbmQodGhpcyksIHRoaXMuZGF0YS5pbnRlcnZhbCArIDUwMCkpO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBfY2xlYXJUaW1lcigpIHtcclxuICAgICAgICAgICAgY29uc3QgdGltZXIgPSB0aGlzLmRhdGEudGltZXI7XHJcbiAgICAgICAgICAgIGlmKHRpbWVyKSB7XHJcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhLnRpbWVyID0gdm9pZCAwO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pO1xyXG4iXX0=