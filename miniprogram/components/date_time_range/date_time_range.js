"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var util_1 = require("./util");
Component({
    properties: {
        value: {
            type: Array,
            value: []
        },
        layout: {
            type: String,
            value: 'year, month, day, hours, minutes'
        },
        selectedIndex: {
            type: Array,
            value: [0, 0, 0, 0, 0, 0]
        }
    },
    data: {
        visible: false,
        progress: 0,
        scrollTop: [],
        px2rpxRatio: 2,
        timer: null,
        setTop: false,
        date: [],
        layoutData: []
    },
    attached: function () {
        var _this = this;
        this.triggerEvent('input', { value: this._fillValue() }, {});
        wx.getSystemInfo({ success: function (res) { return _this.data.px2rpxRatio = 750 / res.windowWidth; } });
    },
    methods: {
        switchPicker: function () {
            var visible = !this.data.visible;
            this.setData({
                visible: visible,
                progress: 0
            });
            this.triggerEvent('mask', { visible: visible }, {});
        },
        none: function () {
        },
        go: function () {
            if (!this.data.progress) {
                this.ok();
            }
            else {
                this.setData({ progress: 0 });
            }
        },
        ok: function () {
            var _this = this;
            var date = new Date();
            this.data.layoutData.forEach(function (v, i) {
                var selected = v[_this.data.selectedIndex[i]];
                var _a = selected.match(/(\d+)([^\d]){1}/), num = _a[1], unit = _a[2];
                switch (unit) {
                    case '年':
                        date.setFullYear(+num);
                        break;
                    case '月':
                        date.setMonth(+num - 1);
                        break;
                    case '日':
                        date.setDate(+num);
                        break;
                    case '时':
                        date.setHours(+num);
                        break;
                    case '分':
                        date.setMinutes(+num);
                        break;
                    case '秒':
                        date.setSeconds(+num);
                        break;
                    default:
                }
            });
            var value = this.data.value;
            value[this.data.progress] = date.getTime();
            if (this.data.progress) {
                this.data.value = value = value.filter(function (v) { return !!v; }).sort(function (a, b) { return a - b; });
                this.switchPicker();
            }
            else {
                this.setData({ progress: 1 });
            }
            this.triggerEvent('input', { value: value }, {});
        },
        scroll: function (e) {
            var _a;
            if (this.data.setTop) {
                return this.data.setTop = false;
            }
            var itemIndex = e.target.dataset.index;
            var index = Math.round(e.detail.scrollTop / 64 * this.data.px2rpxRatio);
            this.setData((_a = {},
                _a["selectedIndex[" + itemIndex + "]"] = index,
                _a));
        },
        setScrollIndex: function (e) {
            var _a;
            var itemIndex = e.target.dataset.index;
            if (itemIndex != null) {
                var index = e.currentTarget.dataset.index;
                this.setData((_a = {},
                    _a["selectedIndex[" + index + "]"] = itemIndex,
                    _a));
            }
        },
        _fillValue: function (value) {
            value = (value || this.data.value).filter(function (v) { return !!v; });
            while (value.length < 2) {
                value.push(Date.now());
            }
            return value.sort(function (a, b) { return a - b; });
        }
    },
    observers: {
        'selectedIndex.**': function (val) {
            var _this = this;
            if (this.data.timer) {
                clearTimeout(this.data.timer);
                this.data.timer = null;
            }
            this.data.timer = setTimeout(function () {
                _this.data.setTop = true;
                _this.setData({ scrollTop: val.map(function (v) { return v * 64; }) });
            }, 100);
        },
        'value.**, progress, layout': function (value, progress, layout) {
            this.data.value = value = this._fillValue(value);
            var date = value.map(function (v) { return util_1.formatTime(layout, v); });
            var layoutData = util_1.getLayoutData(layout, value[progress]);
            this.setData({
                date: date, layoutData: layoutData,
                selectedIndex: util_1.calcSelIndex(layoutData, value[progress])
            });
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZV90aW1lX3JhbmdlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZGF0ZV90aW1lX3JhbmdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBR0EsK0JBQWlFO0FBc0JqRSxTQUFTLENBQXFCO0lBQzFCLFVBQVUsRUFBRTtRQUNSLEtBQUssRUFBRTtZQUNILElBQUksRUFBRSxLQUFLO1lBQ1gsS0FBSyxFQUFFLEVBQUU7U0FDWjtRQUNELE1BQU0sRUFBRTtZQUNKLElBQUksRUFBRSxNQUFNO1lBQ1osS0FBSyxFQUFFLGtDQUFrQztTQUM1QztRQUVELGFBQWEsRUFBRTtZQUNYLElBQUksRUFBRSxLQUFLO1lBQ1gsS0FBSyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDNUI7S0FDSjtJQUNELElBQUksRUFBRTtRQUNGLE9BQU8sRUFBRSxLQUFLO1FBQ2QsUUFBUSxFQUFFLENBQUM7UUFDWCxTQUFTLEVBQUUsRUFBRTtRQUNiLFdBQVcsRUFBRSxDQUFDO1FBQ2QsS0FBSyxFQUFFLElBQUk7UUFDWCxNQUFNLEVBQUUsS0FBSztRQUNiLElBQUksRUFBRSxFQUFFO1FBQ1IsVUFBVSxFQUFFLEVBQUU7S0FDakI7SUFDRCxRQUFRO1FBQVIsaUJBR0M7UUFGRyxJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxFQUFFLEtBQUssRUFBVyxJQUFLLENBQUMsVUFBVSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUN2RSxFQUFFLENBQUMsYUFBYSxDQUFDLEVBQUUsT0FBTyxFQUFFLFVBQUEsR0FBRyxJQUFJLE9BQUEsS0FBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEdBQUcsR0FBRyxHQUFHLEdBQUcsQ0FBQyxXQUFXLEVBQTdDLENBQTZDLEVBQUUsQ0FBQyxDQUFDO0lBQ3hGLENBQUM7SUFDRCxPQUFPLEVBQUU7UUFDTCxZQUFZO1lBQ1IsSUFBTSxPQUFP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S0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2FBQzNELENBQUMsQ0FBQztRQUNQLENBQUM7S0FDSjtDQUNKLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiDml6XmnJ/ml7bpl7TojIPlm7TpgInmi6nlmahcclxuICovXHJcbmltcG9ydCB7IGdldExheW91dERhdGEsIGNhbGNTZWxJbmRleCwgZm9ybWF0VGltZSB9IGZyb20gJy4vdXRpbCc7XHJcblxyXG5pbnRlcmZhY2UgSVJhbmdlRGF0YSB7XHJcbiAgICB2YWx1ZTogbnVtYmVyW107XHJcbiAgICB2aXNpYmxlOiBib29sZWFuO1xyXG4gICAgbGF5b3V0OiBzdHJpbmc7XHJcbiAgICBsYXlvdXREYXRhOiBzdHJpbmdbXVtdO1xyXG4gICAgcHgycnB4UmF0aW86IG51bWJlcjtcclxuICAgIHRpbWVyOiBudW1iZXIgfCBudWxsO1xyXG4gICAgc2VsZWN0ZWRJbmRleDogbnVtYmVyW107XHJcbiAgICBzY3JvbGxUb3A6IG51bWJlcltdO1xyXG4gICAgc2V0VG9wOiBib29sZWFuO1xyXG4gICAgcHJvZ3Jlc3M6IG51bWJlcjtcclxufVxyXG5cclxuaW50ZXJmYWNlIElSYW5nZSBleHRlbmRzIFd4Q29tcG9uZW50IHtcclxuICAgIGRhdGE6IElSYW5nZURhdGE7XHJcbiAgICBzd2l0Y2hQaWNrZXIoKTogdm9pZDtcclxuICAgIG9rKCk6IHZvaWQ7XHJcbiAgICBfZmlsbFZhbHVlKHZhbHVlPzogbnVtYmVyW10pOiBudW1iZXJbXTtcclxufVxyXG5cclxuQ29tcG9uZW50PElSYW5nZSwgSVJhbmdlRGF0YT4oe1xyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIHZhbHVlOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IEFycmF5LFxyXG4gICAgICAgICAgICB2YWx1ZTogW11cclxuICAgICAgICB9LFxyXG4gICAgICAgIGxheW91dDoge1xyXG4gICAgICAgICAgICB0eXBlOiBTdHJpbmcsXHJcbiAgICAgICAgICAgIHZhbHVlOiAneWVhciwgbW9udGgsIGRheSwgaG91cnMsIG1pbnV0ZXMnXHJcbiAgICAgICAgfSxcclxuICAgICAgICAvLyDpgInkuK3nmoTntKLlvJVcclxuICAgICAgICBzZWxlY3RlZEluZGV4OiB7XHJcbiAgICAgICAgICAgIHR5cGU6IEFycmF5LFxyXG4gICAgICAgICAgICB2YWx1ZTogWzAsIDAsIDAsIDAsIDAsIDBdXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIGRhdGE6IHtcclxuICAgICAgICB2aXNpYmxlOiBmYWxzZSxcclxuICAgICAgICBwcm9ncmVzczogMCxcclxuICAgICAgICBzY3JvbGxUb3A6IFtdLCAvLyDmu5rliqjpq5jluqZcclxuICAgICAgICBweDJycHhSYXRpbzogMiwgLy8gMXB4LzFycHhcclxuICAgICAgICB0aW1lcjogbnVsbCxcclxuICAgICAgICBzZXRUb3A6IGZhbHNlLCAvLyDmmK/lkKbmmK/nlLHkuo7orr7nva7mu5rliqjlgLzlvJXlj5HnmoTmu5rliqhcclxuICAgICAgICBkYXRlOiBbXSxcclxuICAgICAgICBsYXlvdXREYXRhOiBbXVxyXG4gICAgfSxcclxuICAgIGF0dGFjaGVkKCkge1xyXG4gICAgICAgIHRoaXMudHJpZ2dlckV2ZW50KCdpbnB1dCcsIHsgdmFsdWU6ICg8SVJhbmdlPnRoaXMpLl9maWxsVmFsdWUoKSB9LCB7fSk7XHJcbiAgICAgICAgd3guZ2V0U3lzdGVtSW5mbyh7IHN1Y2Nlc3M6IHJlcyA9PiB0aGlzLmRhdGEucHgycnB4UmF0aW8gPSA3NTAgLyByZXMud2luZG93V2lkdGggfSk7XHJcbiAgICB9LFxyXG4gICAgbWV0aG9kczoge1xyXG4gICAgICAgIHN3aXRjaFBpY2tlcigpIHtcclxuICAgICAgICAgICAgY29uc3QgdmlzaWJsZSA9ICF0aGlzLmRhdGEudmlzaWJsZTtcclxuICAgICAgICAgICAgdGhpcy5zZXREYXRhKHtcclxuICAgICAgICAgICAgICAgIHZpc2libGUsXHJcbiAgICAgICAgICAgICAgICBwcm9ncmVzczogMFxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMudHJpZ2dlckV2ZW50KCdtYXNrJywgeyB2aXNpYmxlIH0sIHt9KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIG5vbmUoKSB7XHJcbiAgICAgICAgICAgIC8vXHJcbiAgICAgICAgfSxcclxuICAgICAgICBnbygpIHtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmRhdGEucHJvZ3Jlc3MpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMub2soKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7IHByb2dyZXNzOiAwIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBvaygpIHtcclxuICAgICAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YS5sYXlvdXREYXRhLmZvckVhY2goKHYsIGkpID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkID0gdlt0aGlzLmRhdGEuc2VsZWN0ZWRJbmRleFtpXV07XHJcbiAgICAgICAgICAgICAgICBjb25zdCBbLCBudW0sIHVuaXRdID0gPHN0cmluZ1tdPnNlbGVjdGVkLm1hdGNoKC8oXFxkKykoW15cXGRdKXsxfS8pO1xyXG5cclxuICAgICAgICAgICAgICAgIHN3aXRjaCAodW5pdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ+W5tCc6IGRhdGUuc2V0RnVsbFllYXIoK251bSk7IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ+aciCc6IGRhdGUuc2V0TW9udGgoK251bSAtIDEpOyBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICfml6UnOiBkYXRlLnNldERhdGUoK251bSk7IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ+aXtic6IGRhdGUuc2V0SG91cnMoK251bSk7IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ+WIhic6IGRhdGUuc2V0TWludXRlcygrbnVtKTsgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAn56eSJzogZGF0ZS5zZXRTZWNvbmRzKCtudW0pOyBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IHRoaXMuZGF0YS52YWx1ZTtcclxuICAgICAgICAgICAgdmFsdWVbdGhpcy5kYXRhLnByb2dyZXNzXSA9IGRhdGUuZ2V0VGltZSgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuZGF0YS5wcm9ncmVzcykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhLnZhbHVlID0gdmFsdWUgPSB2YWx1ZS5maWx0ZXIodiA9PiAhIXYpLnNvcnQoKGEsIGIpID0+IGEgLSBiKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3dpdGNoUGlja2VyKCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldERhdGEoeyBwcm9ncmVzczogMSB9KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy50cmlnZ2VyRXZlbnQoJ2lucHV0JywgeyB2YWx1ZSB9LCB7fSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzY3JvbGwoZTogQmFzZUV2ZW50KTogZmFsc2UgfCB2b2lkIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZGF0YS5zZXRUb3ApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRhdGEuc2V0VG9wID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGl0ZW1JbmRleCA9IGUudGFyZ2V0LmRhdGFzZXQuaW5kZXg7XHJcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gTWF0aC5yb3VuZChlLmRldGFpbC5zY3JvbGxUb3AgLyA2NCAqIHRoaXMuZGF0YS5weDJycHhSYXRpbyk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgICAgICAgICBbYHNlbGVjdGVkSW5kZXhbJHtpdGVtSW5kZXh9XWBdOiBpbmRleFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldFNjcm9sbEluZGV4KGU6IEJhc2VFdmVudCkge1xyXG4gICAgICAgICAgICBjb25zdCBpdGVtSW5kZXggPSBlLnRhcmdldC5kYXRhc2V0LmluZGV4O1xyXG4gICAgICAgICAgICBpZiAoaXRlbUluZGV4ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW5kZXg7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICAgICAgICAgICAgICAgIFtgc2VsZWN0ZWRJbmRleFske2luZGV4fV1gXTogaXRlbUluZGV4XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgX2ZpbGxWYWx1ZSh2YWx1ZT86IG51bWJlcltdKSB7XHJcbiAgICAgICAgICAgIHZhbHVlID0gKHZhbHVlIHx8IHRoaXMuZGF0YS52YWx1ZSkuZmlsdGVyKHYgPT4gISF2KTtcclxuICAgICAgICAgICAgd2hpbGUgKHZhbHVlLmxlbmd0aCA8IDIpIHtcclxuICAgICAgICAgICAgICAgIHZhbHVlLnB1c2goRGF0ZS5ub3coKSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZS5zb3J0KChhLCBiKSA9PiBhIC0gYik7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIG9ic2VydmVyczoge1xyXG4gICAgICAgICdzZWxlY3RlZEluZGV4LioqJyh2YWw6IG51bWJlcltdKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmRhdGEudGltZXIpIHtcclxuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmRhdGEudGltZXIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhLnRpbWVyID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5kYXRhLnRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEuc2V0VG9wID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7IHNjcm9sbFRvcDogdmFsLm1hcCh2ID0+IHYgKiA2NCkgfSk7XHJcbiAgICAgICAgICAgIH0sIDEwMCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICAndmFsdWUuKiosIHByb2dyZXNzLCBsYXlvdXQnKHZhbHVlOiBudW1iZXJbXSwgcHJvZ3Jlc3M6IG51bWJlciwgbGF5b3V0OiBzdHJpbmcpIHtcclxuICAgICAgICAgICAgdGhpcy5kYXRhLnZhbHVlID0gdmFsdWUgPSB0aGlzLl9maWxsVmFsdWUodmFsdWUpO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgZGF0ZSA9IHZhbHVlLm1hcCh2ID0+IGZvcm1hdFRpbWUobGF5b3V0LCB2KSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGxheW91dERhdGEgPSBnZXRMYXlvdXREYXRhKGxheW91dCwgdmFsdWVbcHJvZ3Jlc3NdKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgICAgICAgICBkYXRlLCBsYXlvdXREYXRhLFxyXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRJbmRleDogY2FsY1NlbEluZGV4KGxheW91dERhdGEsIHZhbHVlW3Byb2dyZXNzXSlcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KTtcclxuIl19